---
title: "Data Processing"
output: html_notebook
---


```{r, setup}

library(tidyverse)
library(magrittr)

```


#Import CSV, create ID var
```{r, eval=FALSE}

RAW <- read_csv("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/J253356/variablesnolabel.csv")
```

```{r}
df <- RAW

df$ID <- df$ER30001*1000 + df$ER30002

```

#RENAME VARIABLES
##Age Head
```{r}
Age.Head <- df %>% select(one_of(c("V117", "V1008", "V1239", "V1942", "V2542", "V3095", "V3508", "V3921", "V4436", "V5350", "V5850", "V6462", "V7067", "V7658", "V8352", "V8961", "V10419", "V11606", "V13011", "V14114", "V15130", "V16631", "V18049", "V19349", "V20651", "V22406", "ER2007", "ER5006", "ER7006", "ER10009", "ER13010", "ER17013", "ER21017", "ER25017", "ER36017", "ER42017", "ER47317", "ER53017", "ER60017")))

names(Age.Head) <- mapply(paste, "Age.Head", c(seq(1968,1997,1), seq(1999,2015, 2)), sep="_")
```

##Age Spouse
```{r}
Age.Spouse <- df %>% select(one_of(c("V118", "V1011", "V1241", "V1944", "V2544", "V3097", "V3510", "V3923", "V4438", "V5352", "V5852", "V6464", "V7069", "V7660", "V8354", "V8963", "V10421", "V11608", "V13013", "V14116", "V15132", "V16633", "V18051", "V19351", "V20653", "V22408", "ER2009", "ER5008", "ER7008", "ER10011", "ER13012", "ER17015", "ER21019", "ER25019", "ER36019", "ER42019", "ER47319", "ER53019", "ER60019")))

names(Age.Spouse) <- mapply(paste, "Age.Spouse", c(seq(1968,1997,1), seq(1999,2015, 2)), sep="_" )
```

##Race Head
```{r}
Race.Head <- df %>% select(one_of(c("V181", "V801", "V1490", "V2202", "V2828", "V3300", "V3720", "V4204", "V5096", "V5662", "V6209", "V6802", "V7447", "V8099", "V8723", "V9408", "V11055", "V11938", "V13565", "V14612", "V16086", "V17483", "V18814", "V20114", "V21420", "V23276", "ER3944", "ER6814", "ER9060", "ER11848", "ER15928", "ER19989", "ER23426", "ER27393", "ER40565", "ER46543", "ER51904", "ER57659", "ER64810")))

names(Race.Head) <- mapply(paste, "Race.Head", c(seq(1968,1997,1), seq(1999,2015, 2)), sep="_" )
```


##Race Spouse
```{r}
Race.Spouse <- df %>% select(one_of(c("V12293", "V13500", "V14547", "V16021", "V17418", "V18749", "V20049", "V21355", "V23212", "ER3883", "ER6753", "ER8999", "ER11760", "ER15836", "ER19897", "ER23334", "ER27297", "ER40472", "ER46449", "ER51810", "ER57549", "ER64671")))

names(Race.Spouse) <- mapply(paste, "Race.Spouse", c(seq(1985,1997,1), seq(1999,2015, 2)), sep="_" )
```


##Family composition change variable
```{r}
FamilyComp <- df %>% select(one_of(c("V542", "V1109", "V1809", "V2410", "V3010", "V3410", "V3810", "V4310", "V5210", "V5710", "V6310", "V6910", "V7510", "V8210", "V8810", "V10010", "V11112", "V12510", "V13710", "V14810", "V16310", "V17710", "V19010", "V20310", "V21608", "ER2005A", "ER5004A", "ER7004A", "ER10004A", "ER13008A", "ER17007", "ER21007", "ER25007", "ER36007", "ER42007", "ER47307", "ER53007", "ER60007")))

names(FamilyComp) <- mapply(paste, "FamilyComp", c(seq(1969,1997,1), seq(1999,2015, 2)), sep="_" )
```

##Family Size
```{r}
FamilySize <- df %>% select(one_of(c("V115", "V549", "V1238", "V1941", "V2541", "V3094", "V3507", "V3920", "V4435", "V5349", "V5849", "V6461", "V7066", "V7657", "V8351", "V8960", "V10418", "V11605", "V13010", "V14113", "V15129", "V16630", "V18048", "V19348", "V20650", "V22405", "ER2006", "ER5005", "ER7005", "ER10008", "ER13009", "ER17012", "ER21016", "ER25016", "ER36016", "ER42016", "ER47316", "ER53016", "ER60016"))) 

names(FamilySize) <- mapply(paste, "FamilySize", c(seq(1968,1997,1), seq(1999,2015, 2)) , sep="_" )
```
##Do you drink alcohol head

```{r}
AlcUse.Head<- df %>% select(one_of(c("ER15550", "ER19715", "ER23130", "ER27105", "ER38316", "ER44289", "ER49627", "ER55375", "ER62497")))
names(AlcUse.Head)<- mapply(paste, "AlcUse.Head", seq(1999, 2015, 2), sep="_" )
                            
```
##Alcohol Use Frequency Head
```{r}
AlcFreq.Head <- df %>% select(one_of(c("ER27106", "ER38317", "ER44290", "ER49628", "ER55376", "ER62498")))

names(AlcFreq.Head) <- mapply(paste, "AlcFreq.Head", seq(2005, 2015, 2), sep="_" )
```

##Alcohol Use Frequency Spouse
```{r}
AlcFreq.Spouse <- df %>% select(one_of(c("ER27229", "ER39414", "ER45387", "ER50746", "ER56492", "ER63614")))

names(AlcFreq.Spouse) <- mapply(paste, "AlcFreq.Spouse", seq(2005, 2015, 2), sep="_" )
```


##Alcohol drinks per day head
```{r}
DrinksPerDay.Head <- df %>% select(one_of(c("ER15551", "ER19716", "ER23131", "ER27107", "ER38318", "ER44291", "ER49629", "ER55377", "ER62499")))

names(DrinksPerDay.Head) <- mapply(paste, "DrinksPerDay.Head", seq(1999,2015, 2), sep="_" )
```

##Alcohol drinks per day spouse
```{r}
DrinksPerDay.Spouse <- df %>% select(one_of(c("ER15659", "ER19824", "ER23258", "ER27230", "ER39415", "ER45388", "ER50747", "ER56493", "ER63615")))

names(DrinksPerDay.Spouse) <- mapply(paste, "DrinksPerDay.Spouse", seq(1999,2015, 2), sep="_" )
```

##Alcohol days with 5 or more drinks head
```{r}
Drink5.Head <- df %>% select(one_of(c("ER27108", "ER38319", "ER44292", "ER49630", "ER55378", "ER62500")))

names(Drink5.Head) <- mapply(paste, "Drink5.Head", seq(2005, 2015, 2), sep="_" )
```

##Alcohol days with 4 or more drinks spouse
```{r}
Drink5.Spouse <- df %>% select(one_of(c("ER27231", "ER39416", "ER45389", "ER50748", "ER56494", "ER63616")))

names(Drink5.Spouse) <- mapply(paste, "Drink5.Spouse", seq(2005, 2015, 2), sep="_" )
```

##Ever smoked head
```{r}
EverSmoked.Head <- df %>% select(one_of(c("V13444", "ER15546", "ER19711", "ER23126", "ER27101", "ER38312", "ER44285", "ER49623", "ER55371", "ER62493")))

names(EverSmoked.Head) <- mapply(paste, "EverSmoked.Head", c(1986, seq(1999,2015, 2)), sep="_" )
```

##Ever smoked spouse
```{r}
EverSmoked.Spouse <- df %>% select(one_of(c("V13479", "ER15654", "ER19819", "ER23253", "ER27224", "ER39409", "ER45382", "ER50741", "ER56487", "ER63609")))

names(EverSmoked.Spouse) <- mapply(paste, "EverSmoked.Spouse", c(1986, seq(1999,2015, 2)), sep="_" )
```

##Depression before age 17 head
```{r}
Depressed17.Head <- df %>% select(one_of(c("ER38341", "ER44314", "ER49654", "ER55402", "ER62524")))

names(Depressed17.Head) <- mapply(paste, "Depressed17.Head", seq(2007,2015, 2), sep="_" )
```

##Depression before age 17 spouse
```{r}
Depressed17.Spouse <- df %>% select(one_of(c("ER39438", "ER45411", "ER50772", "ER56518", "ER63640")))

names(Depressed17.Spouse) <- mapply(paste, "Depressed17.Spouse", seq(2007,2015, 2), sep="_" )
```

##Drug or alc problem before 17 head
```{r}
DrugProb17.Head <- df %>% select(one_of(c("ER38342", "ER44315", "ER49655", "ER55403", "ER62525")))

names(DrugProb17.Head) <- mapply(paste, "DrugProb17.Head", seq(2007,2015, 2), sep="_" )
```

##Drug or alc problem before 17 spouse
```{r}
DrugProb17.Spouse <- df %>% select(one_of(c("ER39439", "ER45412", "ER50773", "ER56519", "ER63641")))

names(DrugProb17.Spouse) <- mapply(paste, "DrugProb17.Spouse", seq(2007,2015, 2), sep="_" )
```

##Health Status Growing Up head
```{r}
KidHealth.Head <- df %>% select(one_of(c("ER38323", "ER44296", "ER49636", "ER55384", "ER62506")))

names(KidHealth.Head) <- mapply(paste, "KidHealth.Head", seq(2007,2015, 2), sep="_" )
```

##Health Status Growing Up spouse
```{r}
KidHealth.Spouse <- df %>% select(one_of(c("ER39420", "ER45393", "ER50754", "ER56500", "ER63622")))

names(KidHealth.Spouse) <- mapply(paste, "KidHealth.Spouse", seq(2007,2015, 2), sep="_" )
```

##Other emotional/psychologic problems head
```{r}
EmotProb.Head <- df %>% select(one_of(c("ER38343", "ER44316", "ER49656", "ER55404", "ER62526")))

names(EmotProb.Head) <- mapply(paste, "EmotProb.Head", seq(2007,2015, 2), sep="_" )
```

##Other emotional/psychologic problems spouse
```{r}
EmotProb.Spouse <- df %>% select(one_of(c("ER39440", "ER45413", "ER50774", "ER56520", "ER63642")))

names(EmotProb.Spouse) <- mapply(paste, "EmotProb.Spouse", seq(2007,2015, 2), sep="_" )
```

##Health insurance coverage in last 2 years anyone in family
```{r}
Insurance2 <- df %>% select(one_of(c("ER15779", "ER19840", "ER23277", "ER27237", "ER40409", "ER46382", "ER51743")))

names(Insurance2) <- mapply(paste, "Insurance2", seq(1999,2011, 2), sep="_" )
```


##Health insurance head + family
```{r}
InsuranceHeadFam <- df %>% select(one_of(c("V158", "V740", "V1406", "V2118", "V2715", "V7287")))

names(InsuranceHeadFam) <- mapply(paste, "InsuranceHeadFam", c(seq(1968,1972, 1), 1980), sep="_" )
```


##Medicaid/medicare anyone in family
```{r}
Medicaid <- df %>% select(one_of(c("V6686", "V7289", "V7989", "V9299", "V10890", "V11997", "V13448", "V14520", "V15997", "V17394", "V18725", "V20025", "V21326", "V23185", "ER3857", "ER6727", "ER8973")))

names(Medicaid) <- mapply(paste, "Medicaid", c(1979, 1980, 1981, seq(1983,1996, 1)), sep="_" )
```


##K6
```{r}
K6.Head <- df %>% select(one_of(c("ER19833A", "ER23268", "ER40402", "ER46375", "ER51736", "ER57482", "ER64604")))

names(K6.Head) <- mapply(paste, "K6.Head", c(2001, 2003, seq(2007,2015, 2)), sep="_" )
```


##Doctor told you emotional, nervous, psych problems head
```{r}
DrEmotProb.Head <- df %>% select(one_of(c("ER15494", "ER19659", "ER23059", "ER27045", "ER38256", "ER44229", "ER49562", "ER55311", "ER62433")))

names(DrEmotProb.Head) <- mapply(paste, "DrEmotProb.Head", seq(1999,2015, 2), sep="_" )
```


##Age when doctor told you emotional, nervous, psych problems head
```{r}
AgeDrEmotProb.Head <- df %>% select(one_of(c("ER27046", "ER38257", "ER44230", "ER49564", "ER55312", "ER62434")))

names(AgeDrEmotProb.Head) <- mapply(paste, "AgeDrEmotProb.Head", seq(2005,2015, 2), sep="_" )
```


##Medication if doctor told you emotional, nervous, psych problems head
```{r}
MedforPsych.Head <- df %>% select(one_of(c("ER49572", "ER55320", "ER62442")))

names(MedforPsych.Head) <- mapply(paste, "MedforPsych.Head", seq(2011,2015, 2), sep="_" )

```


##Condition if doctor told you emotional, nervous, psych problems head
```{r}
ConditionPsych.Head <- df %>% select(one_of(c("ER27047", "ER38258", "ER44231", "ER49565", "ER55313", "ER62435")))

names(ConditionPsych.Head) <- mapply(paste, "ConditionPsych.Head", seq(2005,2015, 2), sep="_" )
```


##Doctor told you emotional, nervous, psych problems Spouse
```{r}
DrEmotProb.Spouse <- df %>% select(one_of(c("ER15602", "ER19767", "ER23186", "ER27168", "ER39353", "ER45326", "ER50680", "ER56427", "ER63549")))

names(DrEmotProb.Spouse) <- mapply(paste, "DrEmotProb.Spouse", seq(1999,2015, 2), sep="_" )
```


##Age when doctor told you emotional, nervous, psych problems Spouse
```{r}
AgeDrEmotProb.Spouse <- df %>% select(one_of(c("ER27169", "ER39354", "ER45327", "ER50682", "ER56428", "ER63550")))

names(AgeDrEmotProb.Spouse) <- mapply(paste, "AgeDrEmotProb.Spouse", seq(2005,2015, 2), sep="_" )
```


##Medication if doctor told you emotional, nervous, psych problems Spouse
```{r}
MedforPsych.Spouse <- df %>% select(one_of(c("ER50690", "ER56436", "ER63558")))

names(MedforPsych.Spouse) <- mapply(paste, "MedforPsych.Spouse", seq(2011,2015, 2), sep="_" )

```


##Condition if doctor told you emotional, nervous, psych problems Spouse
```{r}
ConditionPsych.Spouse <- df %>% select(one_of(c("ER27170", "ER39355", "ER45328", "ER50683", "ER56429", "ER63551")))

names(ConditionPsych.Spouse) <- mapply(paste, "ConditionPsych.Spouse", seq(2005,2015, 2), sep="_" )
```


##Doctor told you learning disorder head
```{r}
DrLearnDisord.Head <- df %>% select(one_of(c("ER15518", "ER19683", "ER23083", "ER27034", "ER38245", "ER44218", "ER49548", "ER55298", "ER62420")))

names(DrLearnDisord.Head) <- mapply(paste, "DrLearnDisord.Head", seq(1999,2015, 2), sep="_" )
```

##Age when doctor told you had learning disorder head

```{r}
AgeDrLearnDisord.Head <- df %>% select(one_of(c("ER27035", "ER38246", "ER44219", "ER49550", "ER55300", "ER62422")))

names(AgeDrLearnDisord.Head) <- mapply(paste, "AgeDrLearnDisord.Head", seq(2005,2015, 2), sep="_" )
```


##Medication if doctor told you had learning disorder head
```{r}
MedLearnDisord.Head <- df %>% select(one_of(c("ER49552", "ER55302", "ER62424")))

names(MedLearnDisord.Head) <- mapply(paste, "MedLearnDisord.Head", seq(2011,2015, 2), sep="_" )
```

##Doctor told you learning disorder Spouse
```{r}
DrLearnDisord.Spouse <- df %>% select(one_of(c("ER15626", "ER19791", "ER23210", "ER27157", "ER39342", "ER45315", "ER50666", "ER56414", "ER63536")))

names(DrLearnDisord.Spouse) <- mapply(paste, "DrLearnDisord.Spouse", seq(1999,2015, 2), sep="_" )
```

##Age when doctor told you had learning disorder Spouse

```{r}
AgeDrLearnDisord.Spouse <- df %>% select(one_of(c("ER27158", "ER39343", "ER45316", "ER50668", "ER56416", "ER63538")))

names(AgeDrLearnDisord.Spouse) <- mapply(paste, "AgeDrLearnDisord.Spouse", seq(2005,2015, 2), sep="_" )
```


##Medication if doctor told you had learning disorder Spouse
```{r}
MedLearnDisord.Spouse <- df %>% select(one_of(c("ER50670", "ER56418", "ER63540")))

names(MedLearnDisord.Spouse) <- mapply(paste, "MedLearnDisord.Spouse", seq(2011,2015, 2), sep="_" )
```

##Doctor told you loss of mental ability/memory head
```{r}
DrMemLoss.Head <- df %>% select(one_of(c("ER15512", "ER19677", "ER23077", "ER27030", "ER38241", "ER44214", "ER49543", "ER55293", "ER62415")))

names(DrMemLoss.Head) <- mapply(paste, "DrMemLoss.Head", seq(1999,2015, 2), sep="_" )
```

##Age when doctor told you loss of mental ability/memory head
```{r}
DrMemLoss.Head <- df %>% select(one_of(c("ER27031", "ER38242", "ER44215", "ER49545", "ER55295", "ER62417")))

names(DrMemLoss.Head) <- mapply(paste, "DrMemLoss.Head", seq(2005,2015, 2), sep="_" )
```

##Medication if doctor told you loss of mental ability/memory head
```{r}
DrMemLoss.Head <- df %>% select(one_of(c("ER49547", "ER55297", "ER62419")))

names(DrMemLoss.Head) <- mapply(paste, "DrMemLoss.Head", seq(2011,2015, 2), sep="_" )
```

##Doctor told you loss of mental ability/memory Spouse
```{r}
DrMemLoss.Spouse <- df %>% select(one_of(c("ER15620", "ER19785", "ER23204", "ER27153", "ER39338", "ER45311", "ER50661", "ER56409", "ER63531")))

names(DrMemLoss.Spouse) <- mapply(paste, "DrMemLoss.Spouse", seq(1999,2015, 2), sep="_" )
```

##Age when doctor told you loss of mental ability/memory Spouse
```{r}
DrMemLoss.Spouse <- df %>% select(one_of(c("ER27154", "ER39339", "ER45312", "ER50663", "ER56411", "ER63533")))

names(DrMemLoss.Spouse) <- mapply(paste, "DrMemLoss.Spouse", seq(2005,2015, 2), sep="_" )
```

##Medication if doctor told you loss of mental ability/memory Spouse
```{r}
DrMemLoss.Spouse <- df %>% select(one_of(c("ER50665", "ER56413", "ER63535")))

names(DrMemLoss.Spouse) <- mapply(paste, "DrMemLoss.Spouse", seq(2011,2015, 2), sep="_" )
```


##General health status head
```{r}
GenHealth.Head <- df %>% select(one_of(c("V10877", "V11991", "V13417", "V14513", "V15993", "V17390", "V18721", "V20021", "V21321", "V23180", "ER3853",  "ER6723", "ER8969", "ER11723", "ER15447", "ER19612", "ER23009", "ER26990", "ER38202", "ER44175", "ER49494", "ER55244", "ER62366")))
                                       
names(GenHealth.Head) <- mapply(paste, "GenHealth.Head", c(seq(1984,1997, 1), seq(1999,2015, 2)), sep="_")

```

##General health status spouse
```{r}
GenHealth.Spouse <- df %>% select(one_of(c("V10884", "V12344", "V13452", "V14524", "V15999", "V17396", "V18727", "V20027", "V21328", "V23187", "ER3858", "ER6728", "ER8974", "ER11727", "ER15555", "ER19720", "ER23136", "ER27113", "ER39299", "ER45272", "ER50612", "ER56360", "ER63482")))
                                       
names(GenHealth.Spouse) <- mapply(paste, "GenHealth.Spouse", c(seq(1984,1997, 1), seq(1999,2015, 2)), sep="_")
``` 

##Housing status own or rent
```{r}
OwnRent <- df %>% select(one_of(c("V103", "V593", "V1264", "V1967", "V2566", "V3108", "V3522", "V3939", "V4450", "V5364", "V5864", "V6479", "V7084", "V7675", "V8364", "V8974", "V10437", "V11618", "V13023", "V14126", "V15140", "V16641", "V18072", "V19372", "V20672", "V22427", "ER2032", "ER5031", "ER7031", "ER10035", "ER13040", "ER17043", "ER21042", "ER25028", "ER36028", "ER42029", "ER47329", "ER53029", "ER60030")))

names(OwnRent) <- mapply(paste, "OwnRent", c(seq(1968,1997, 1), seq(1999, 2015, 2)), sep="_")
``` 

##Income from interest head

```{r}
InterestIncome.Head <- df %>% select(one_of(c("V21861", "ER27936", "ER40926", "ER46834", "ER52242", "ER58043", "ER65221")))

names(InterestIncome.Head) <- mapply(paste, "InterestIncome.Head", c(1993, seq(2005,2015, 2)), sep="_")
```

##Income from interest spouse
```{r}
InterestIncome.Spouse <- df %>% select(one_of(c("V21925", "ER27949", "ER40939", "ER46847", "ER52255", "ER58056", "ER65249")))

names(InterestIncome.Spouse) <- mapply(paste, "InterestIncome.Spouse", c(1993, seq(2005,2015, 2)), sep="_")
```

##Total income from labor head
```{r}
TotalLaborIncome.Head <- df %>% select(one_of(c("V74", "V514", "V1196", "V1897", "V2498", "V3051", "V3463", "V3863", "V5031", "V5627", "V6174", "V6767", "V7413", "V8066", "V8690", "V9376", "V11023", "V12372", "V13624", "V14671", "V16145", "V17534", "V18878", "V20178",  "V21484", "V23323", "ER4140", "ER6980", "ER9231", "ER12080", "ER16463", "ER20443", "ER24116", "ER27931", "ER40921", "ER46829", "ER52237", "ER58038", "ER65216")))

names(TotalLaborIncome.Head) <- mapply(paste, "TotalLaborIncome.Head", c(seq(1968,1997, 1), seq(1999,2015, 2)), sep="_")
```

##Wages and salary head
```{r}
WageSal.Head <- df %>% select(one_of(c("V251", "V699", "V1191", "V1892", "V2493", "V3046", "V3458", "V3858", "V4373", "V5283", "V5782", "V6391",  "V6981", "V7573", "V8265", "V8873", "V10256", "V11397", "V12796", "V13898", "V14913", "V16413", "V17829",  "V19129", "V20429", "V21739", "ER4122", "ER6962", "ER9213", "ER12196", "ER16493", "ER20425", "ER24117",  "ER27913", "ER40903", "ER46811", "ER52219", "ER58020", "ER65200")))

names(WageSal.Head) <- mapply(paste, "WageSal.Head", c(seq(1968,1997, 1), seq(1999,2015, 2)), sep="_")
```

##Wife's money income from work to 1993
```{r}
TotalLaborIncome1.Spouse <- df %>% select(one_of(c("V75", "V516", "V1198", "V1899", "V2500", "V3053", "V3465", "V3865", "V4379", "V5289", "V5788", "V6398", "V6988", "V7580", "V8273", "V8881", "V10263", "V11404", "V12803", "V13905","V14920", "V16420", "V17836", "V19136", "V20436", "V23324")))

names(TotalLaborIncome1.Spouse) <- mapply(paste, "TotalLaborIncome1.Spouse", seq(1968,1993,1), sep="_")
```

##Wife's money income from work from 1993
```{r}
TotalLaborIncome2.Spouse <- df %>% select(one_of(c("V21807", "ER4144", "ER6984", "ER9235", "ER12082", "ER16465", "ER20447", "ER24135", "ER27943", "ER40933", "ER46841", "ER52249", "ER58050", "ER65244")))

names(TotalLaborIncome2.Spouse) <- mapply(paste, "TotalLaborIncome2.Spouse", c(seq(1993,1997,1), seq(1999,2015,2)), sep="_")
```



##Years worked since 18 head
```{r}
YearsWorked.Head <- df %>% select(one_of(c("V3620", "V4141", "V4630", "V5604", "V6153", "V6750", "V7383", "V8035", "V8659", "V9345", "V10992", "V11739", "V13605", "V14652", "V16126", "V17523", "V18854", "V20154", "V21460", "V23316", "ER3985", "ER6855", "ER9101", "ER11897", "ER15979", "ER20040", "ER23476", "ER27444", "ER40616", "ER46594", "ER51955", "ER57711", "ER64871")))

names(YearsWorked.Head) <- mapply(paste, "YearsWorked.Head", c(seq(1974,1997,1), seq(1999, 2015, 2)), sep="_")
```

##Years worked since 18 spouse
```{r}
YearsWorked.Spouse <- df %>% select(one_of(c("V3610", "V4110", "V4989", "V5574", "V6123", "V6720", "V7353", "V8005", "V8629", "V9315", "V10962", "V12102", "V13531", "V14578", "V16052", "V17449", "V18780", "V20080", "V21386", "V23243", "ER3915", "ER6785", "ER9031", "ER11809", "ER15886", "ER19947", "ER23384", "ER27348", "ER40523", "ER46500", "ER51861", "ER57601", "ER64732")))

names(YearsWorked.Spouse) <- mapply(paste, "YearsWorked.Spouse", c(seq(1974,1997,1), seq(1999, 2015, 2)), sep="_")
```


##Employment status head - ever had a job
```{r}
EverJob.Head<- df %>% select(one_of(c("V4552", "V5454", "V5971", "V6556", "V7158", "V7806", "V8467", "V9104", "V10604", "V11751", "V13147", "V14245", "V15318", "V16833", "V18257", "V19557", "V20857", "V22644", "ER2324", "ER5323", "ER7419", "ER10337", "ER13476", "ER17515", "ER21357", "ER25346", "ER36351", "ER42376", "ER47689", "ER53389", "ER60404")))

names(EverJob.Head) <- mapply(paste, "EverJob.Head", c(seq(1976,1997,1), seq(1999, 2015, 2)), sep="_")

```


##Employment status spouse ever had a job
```{r}
EverJob.Spouse <- df %>% select(one_of(c("V4936", "V6628", "V7230", "V7919", "V8574", "V9233", "V10804", "V12114", "V13315", "V14409", "V15620", "V17152", "V18559", "V19859", "V21159", "V22997", "ER2818", "ER5817", "ER7913", "ER10819", "ER13988", "ER18086", "ER21607", "ER25604", "ER36609", "ER42628", "ER47946", "ER53652", "ER60667")))

names(EverJob.Spouse) <- mapply(paste, "EverJob.Spouse", c(1976, seq(1979,1997,1), seq(1999, 2015, 2)), sep="_")
```

##Employment status working now 1? Head
```{r}
EmployedNow1.Head <- df %>% select(one_of(c("V196", "V639", "V1278", "V1983", "V2581", "V3114", "V3528", "V3967", "V4458", "V5373", "V5872", "V6492", "V7095", "V7706", "V8374", "V9005", "V10453", "V11637", "V13046", "V14146", "V15154", "V16655", "V18093", "V19393", "V20693", "V22448", "ER2068", "ER5067", "ER7163")))

names(EmployedNow1.Head) <- mapply(paste, "EmployedNow1.Head", seq(1968, 1996, 1), sep="_")
```

##Employment status working now 2  head
```{r}
EmployedNow2.Head <- df %>% select(one_of(c("ER2069", "ER5068", "ER7164", "ER10081", "ER13205", "ER17216", "ER21123", "ER25104", "ER36109", "ER42140", "ER47448", "ER53148", "ER60163")))
names(EmployedNow2.Head) <- mapply(paste, "EmployedNow2.Head", c(seq(1994,1997,1), seq(1999,2015,2)), sep="_")
```

##Employment status working now spouse
```{r}
EmployedNow1.Spouse <- df %>% select(one_of(c("V4841", "V6591", "V7193", "V7879", "V8538", "V9188", "V10671", "V12000", "V13225", "V14321", "V15456", "V16974", "V18395", "V19695", "V20995", "V22801", "ER2562", "ER5561", "ER7657")))

names(EmployedNow1.Spouse) <- mapply(paste, "EmployedNow1.Spouse", c(1976, seq(1979,1996,1)), sep="_")
```

##Employment status working now spouse
```{r}
EmployedNow2.Spouse <- df %>% select(one_of(c("ER2563", "ER5562", "ER7658", "ER10563", "ER13717", "ER17786", "ER21373", "ER25362", "ER36367", "ER42392", "ER47705", "ER53411", "ER60426")))
names(EmployedNow2.Spouse) <- mapply(paste, "EmployedNow2.Spouse", c(seq(1994,1997,1), seq(1999,2015,2)), sep="_")
```

##Head's annual work hours
```{r}
WorkHrs.Head <- df %>% select(one_of(c("V47", "V465", "V1138", "V1839", "V2439", "V3027", "V3423", "V3823", "V4332", "V5232", "V5731", "V6336", "V6934", "V7530", "V8228", "V8830", "V10037", "V11146", "V12545", "V13745", "V14835", "V16335", "V17744", "V19044", "V20344", "V21634", "ER4096", "ER6936", "ER9187", "ER12174", "ER16471", "ER20399", "ER24080", "ER27886", "ER40876", "ER46767", "ER52175", "ER57976", "ER65156")))
names(WorkHrs.Head) <- mapply(paste, "WorkHrs.Head", c(seq(1968,1997,1), seq(1999,2015, 2)), sep="_") 
```

##Spouse annual work hours
```{r}
WorkHrs.Spouse <- df %>% select(one_of(c("V53", "V475", "V1148", "V1849", "V2449", "V3035", "V3431", "V3831", "V4344", "V5244", "V5743", "V6348", "V6946", "V7540", "V8238", "V8840", "V10131", "V11258", "V12657", "V13809", "V14865", "V16365", "V17774", "V19074", "V20374", "V21670", "ER4107", "ER6947", "ER9198", "ER12185", "ER16482", "ER20410", "ER24091", "ER27897", "ER40887", "ER46788", "ER52196", "ER57997", "ER65177")))
names(WorkHrs.Spouse) <- mapply(paste, "WorkHrs.Spouse", c(seq(1968,1997,1), seq(1999,2015, 2)), sep="_") 
```

##Industry of head - 1970 code
```{r}
Industry1980.Head <- df %>% select(one_of(c("V197_B", "V640_B", "V1279_B", "V1985_A", "V2583_A", "V3116_A", "V3531_A", "V3969_A", "V4460_A", "V5375_A", "V5874_A", "V6498_A", "V7101_A")))
names(Industry1980.Head) <- mapply(paste, "Industry1980.Head", seq(1968,1980,1), sep="_")
```

##Industry of spouse - 1970 code
```{r}
Industry1980.Spouse <- df %>% select(one_of(c("V243_B", "V609_B", "V1367_B", "V2075_A", "V2673_A", "V3184_A", "V3602_A", "V4056_A", "V4606_A", "V5508_A", "V6040_A", "V6597_A", "V7199_A")))
names(Industry1980.Spouse) <- mapply(paste, "Industry1980.Spouse", seq(1968,1980,1), sep="_")
```

##Industry of head - 1970 code
```{r}
Industry2001.Head <- df %>% select(one_of(c("V7713", "V8381", "V9012", "V10461", "V11652", "V13055", "V14155", "V15163", "V16664", "V18102", "V19402", "V20702", "V22457", "ER4018", "ER6858", "ER9109", "ER12086", "ER13216", "ER17227")))

names(Industry2001.Head) <- mapply(paste, "Industry2001.Head", c(seq(1981,1997,1), 1999,2001), sep="_")
```

##Industry of spouse - 1970 code
```{r}
Industry2001.Spouse <- df %>% select(one_of(c("V7886", "V8545", "V9195", "V10679", "V12015", "V13234", "V14330", "V15465", "V16983", "V18404", "V19704", "V21004", "V22810", "ER4049", "ER6889", "ER9140", "ER12117", "ER13728", "ER17797")))

names(Industry2001.Spouse) <- mapply(paste, "Industry2001.Spouse", c(seq(1981,1997,1), 1999,2001), sep="_")
```

##Industry of head - 2000 code
```{r}
Industry2015.Head <- df %>% select(one_of(c("ER21146", "ER25128", "ER36133", "ER42168", "ER47480", "ER53180", "ER60195")))
names(Industry2015.Head) <- mapply(paste, "Industry2015.Head", seq(2003,2015, 2), sep="_")
```

##Industry of spouse -- 2000 code
```{r}
Industry2015.Spouse <- df %>% select(one_of(c("ER21396", "ER25386", "ER36391", "ER42420", "ER47737", "ER53443", "ER60458")))
names(Industry2015.Spouse) <- mapply(paste, "Industry2015.Spouse", seq(2003,2015, 2), sep="_")
```


##INDUSTRY FULL HEAD

```{r}
Industry.Head <- df %>% select(one_of(c("V197_B", "V640_B", "V1279_B", "V1985_A", "V2583_A", "V3116_A", "V3531_A", "V3969_A", "V4460_A", "V5375_A", "V5874_A", "V6498_A", "V7101_A", "V7713", "V8381", "V9012", "V10461", "V11652", "V13055", "V14155", "V15163", "V16664", "V18102", "V19402", "V20702", "V22457", "ER4018", "ER6858", "ER9109", "ER12086", "ER13216", "ER17227", "ER21146", "ER25128", "ER36133", "ER42168", "ER47480", "ER53180", "ER60195")))

names(Industry.Head) <- mapply(paste, "Industry.Head", c(seq(1968,1980,1), seq(1981,1997,1), 1999,2001, seq(2003,2015, 2)), sep="_")
```


##Head occupation --1970 code
```{r}
Occupation1980.Head <- df %>% select(one_of(c("V197_A", "V640_A", "V1279_A", "V1984_A", "V2582_A", "V3115_A", "V3530_A", "V3968_A", "V4459_A", "V5374_A", "V5873_A", "V6497_A", "V7100_A")))

names(Occupation1980.Head) <- mapply(paste, "Occupation1980.Head", seq(1968,1980,1), sep="_")
```

##Spouse occupation -- 1970 code
```{r}
Occupation1980.Spouse <- df %>% select(one_of(c("V243_A", "V609_A", "V1367_A", "V2074_A", "V2672_A", "V3183_A", "V3601_A", "V4055_A", "V4605_A", "V5507_A", "V6039_A", "V6596_A", "V7198_A")))
names(Occupation1980.Spouse) <- mapply(paste, "Occupation1980.Spouse", seq(1968,1980,1), sep="_")
```

##Head occupation 1970 code
```{r}
Occupation2001.Head <- df %>% select(one_of(c("V3529", "V7712", "V8380", "V9011", "V10460", "V11651", "V13054", "V14154", "V15162", "V16663", "V18101", "V19401", "V20701", "V22456", "ER4017", "ER6857", "ER9108", "ER12085", "ER13215", "ER17226")))

names(Occupation2001.Head) <- mapply(paste, "Occupation2001.Head", c(1974, seq(1981,1997,1), 1999, 2001), sep="_")
```

##Spouse occupation 1970 code
```{r}
Occupation2001.Spouse <- df %>% select(one_of(c("V7885", "V8544", "V9194", "V10678", "V12014", "V13233", "V14329", "V15464", "V16982", "V18403", "V19703", "V21003", "V22809", "ER4048", "ER6888", "ER9139", "ER12116", "ER13727", "ER17796")))

names(Occupation2001.Spouse) <-  mapply(paste, "Occupation2001.Spouse",c(seq(1981,1997,1), 1999, 2001), sep="_")
```



##Head self-employed?
```{r}
SelfEmp2001.Head <- df %>% select(one_of(c("V198", "V641", "V1280", "V1986", "V2584", "V3117", "V3532", "V3970", "V4461", "V5376", "V5875", "V6493", "V7096", "V7707", "V8375", "V9006", "V10456", "V11640", "V13049", "V14149", "V15157", "V16658", "V18096", "V19396", "V20696", "V22451", "ER2074", "ER5073", "ER7169", "ER10086", "ER13210", "ER17221")))

names(SelfEmp2001.Head) <- mapply(paste, "SelEmp2001.Head", c(seq(1968,1997,1), 1999, 2001), sep="_")
```

##Spouse self-employed?
```{r}
SelfEmp2001.Spouse <- df %>% select(one_of(c("V4844", "V6592", "V7194", "V7880", "V8539", "V9189", "V10674", "V12003", "V13228", "V14324", "V15459", "V16977", "V18398", "V19698", "V20998", "V22804", "ER2568", "ER5567", "ER7663", "ER10568", "ER13722", "ER17791")))

names(SelfEmp2001.Spouse) <- mapply(paste, "SelfEmp2001.Spouse", c(1974, seq(1979,1997,1), 1999, 2001), sep="_")
```

##Head occupation -- 2000 code
```{r}
Occupation2015.Head <- df %>% select(one_of(c("ER21145", "ER25127", "ER36132", "ER42167", "ER47479", "ER53179", "ER60194")))
names(Occupation2015.Head) <- mapply(paste, "Occupation2015.Head", seq(2003,2015,2), sep="_")
```

##Head self employed
```{r}
SelfEmp2015.Head <- df %>% select(one_of(c("ER21147", "ER25129", "ER36134", "ER42169", "ER47482", "ER53182", "ER60197")))
names(SelfEmp2015.Head) <- mapply(paste, "SelfEmp2015.Head", seq(2003,2015,2), sep="_")
```

##Spouse occupation --- 2000 code
```{r}
Occupation2015.Spouse <- df %>% select(one_of(c("ER21395", "ER25385", "ER36390", "ER42419", "ER47736", "ER53442", "ER60457")))
names(Occupation2015.Spouse) <- mapply(paste, "Occupation2015.Spouse", seq(2003,2015,2), sep="_")
```

##Spouse self employed
```{r}
SelfEmp2015.Spouse <- df %>% select(one_of(c("ER21397", "ER25387", "ER36392", "ER42421", "ER47739", "ER53445", "ER60460")))
names(SelfEmp2015.Spouse) <- mapply(paste, "SelfEmp2015.Spouse", seq(2003,2015,2), sep="_")
```


## OCCUPATION FULL HEAD

```{r}
Occupation.Head <- df %>% select(one_of(c("V197_A", "V640_A", "V1279_A", "V1984_A", "V2582_A", "V3115_A", "V3530_A", "V3968_A", "V4459_A", "V5374_A", "V5873_A", "V6497_A", "V7100_A", "V3529", "V7712", "V8380", "V9011", "V10460", "V11651", "V13054", "V14154", "V15162", "V16663", "V18101", "V19401", "V20701", "V22456", "ER4017", "ER6857", "ER9108", "ER12085", "ER13215", "ER17226", "ER21145", "ER25127", "ER36132", "ER42167", "ER47479", "ER53179", "ER60194" )))

names(Occupation.Head) <- mapply(paste, "Occupation.Head", c(seq(1968,1980,1), 1974, seq(1981,1997,1), 1999, 2001, seq(2003,2015,2)), sep="_")
```



##Head belong to union
```{r}

UnionMember1981.Head <- df %>% select(one_of(c("V766", "V1434", "V2145", "V2787", "V3636", "V4087", "V4624", "V5559", "V6101", "V6707", "V7340", "V7971")))

names(UnionMember1981.Head) <- mapply(paste, "UnionMember1981.Head", c(seq(1969,1972,1), seq(1974,1981,1)), sep="_")
```

##Spouse belong to union
```{r}
UnionMember1981.Spouse <- df %>% select(one_of(c("V4929", "V6709", "V7342", "V7973")))

names(UnionMember1981.Spouse) <- mapply(paste,"UnionMember1981.Spouse", c(1976, 1979:1981), sep="_")
```

##Head covered by union
```{r}
UnionCovered.Head <- df %>% select(one_of(c("V4478", "V5382", "V5877", "V6495", "V7098", "V7709", "V8377", "V9008", "V10458", "V11649", "V13052", "V14152", "V15160", "V16661", "V18099", "V19399", "V20699", "V22454", "ER2079", "ER5078", "ER7174", "ER10089", "ER13213", "ER17224", "ER21150", "ER25138", "ER36143", "ER42178", "ER47491", "ER53191", "ER60206")))

names(UnionCovered.Head) <- mapply(paste, "UnionCovered.Head", c(1976:1997, seq(1999,2015,2)), sep="_")
```

##Spouse covered by union
```{r}
UnionCovered.Spouse <- df %>% select(one_of(c("V4861", "V6594", "V7196", "V7882", "V8541", "V9191", "V10676", "V12012", "V13231", "V14327", "V15462", "V16980", "V18401", "V19701", "V21001", "V22807", "ER2573", "ER5572", "ER7668", "ER10571", "ER13725", "ER17794", "ER21400", "ER25396", "ER36401", "ER42430", "ER47748", "ER53454", "ER60469")))

names(UnionCovered.Spouse) <- mapply(paste, "UnionCovered.Spouse", c(1976, 1979:1997, seq(1999,2015,2)), sep="_")
```

##AGE
```{r}
Age.Head <- df %>% select(one_of(c("ER30004", "ER30023", "ER30046", "ER30070", "ER30094", "ER30120", "ER30141", "ER30163", "ER30191", "ER30220", "ER30249", "ER30286", "ER30316", "ER30346", "ER30376", "ER30402", "ER30432", "ER30466", "ER30501", "ER30538", "ER30573", "ER30609", "ER30645", "ER30692", "ER30736", "ER30809", "ER33104", "ER33204", "ER33304", "ER33404", "ER33504", "ER33604", "ER33704", "ER33804", "ER33904", "ER34004", "ER34104", "ER34204", "ER34305")))

names(Age.Head) <- mapply(paste, "Age.Head", c(1968:1997, seq(1999,2015,2)), sep="_")
```

##SEX
```{r}
df$Sex <- df$ER32000

```

##Grades completed
```{r}
GradesCompl <- df %>% select(one_of(c("ER30010", "ER30052", "ER30076", "ER30100", "ER30126", "ER30147", "ER30169", "ER30197", "ER30226", "ER30255", "ER30296", "ER30326", "ER30356", "ER30384", "ER30413", "ER30443", "ER30478", "ER30513", "ER30549", "ER30584", "ER30620", "ER30657", "ER30703", "ER30748", "ER30820", "ER33115", "ER33215", "ER33315", "ER33415", "ER33516", "ER33616", "ER33716", "ER33817", "ER33917", "ER34020", "ER34119", "ER34230", "ER34349")))

names(GradesCompl) <- mapply(paste, "GradesCompl", c(1968, 1970:1997, seq(1999,2015,2)), sep="_")
```

##Health insurance covered now
```{r}
HealthInsNow <- df %>% select(one_of(c("ER34128", "ER34235", "ER34385")))
names(HealthInsNow) <- mapply(paste, "HealthInsNow", c(2011,2013,2015), sep="_")
```

##Sample weight longitudinal core and immigrant
```{r}
SampWeight2015 <- df %>% select(one_of(c("ER33430", "ER33546", "ER33637", "ER33740", "ER33848", "ER33950", "ER34045", "ER34154", "ER34268", "ER34413")))

names(SampWeight2015) <- mapply(paste, "SampWeight2015", seq(1997, 2015, 2), sep="_")

```

##Sample weight longitudinal core
```{r}
SampWeight1996<- df %>% select(one_of(c("ER30019", "ER30042", "ER30066", "ER30090", "ER30116", "ER30137", "ER30159", "ER30187", "ER30216", "ER30245", "ER30282", "ER30312", "ER30342", "ER30372", "ER30398", "ER30428", "ER30462", "ER30497", "ER30534", "ER30569", "ER30605", "ER30641", "ER30686", "ER30730", "ER30803")))

names(SampWeight1996) <- mapply(paste, "SampWeight1996", c(1968:1992), sep="_")
```

##Sample weight longitudinal core 1993 revised
```{r}
SampWeight9396Rev <- df %>% select(one_of(c("ER30864", "ER33119", "ER33275", "ER33318")))
names(SampWeight9396Rev) <- mapply(paste, "SampWeight9396Rev", c(1993:1996), sep="_")
```

##ID INTERVIEW NUMBER 
```{r}
InterviewNum <- df %>% select(one_of(c("ER30001", "ER30020", "ER30043", "ER30067", "ER30091", "ER30117", "ER30138", "ER30160", "ER30188", "ER30217", "ER30246", "ER30283", "ER30313", "ER30343", "ER30373", "ER30399", "ER30429", "ER30463", "ER30498", "ER30535", "ER30570", "ER30606", "ER30642", "ER30689", "ER30733", "ER30806", "ER33101", "ER33201", "ER33301", "ER33401", "ER33501", "ER33601", "ER33701", "ER33801", "ER33901", "ER34001", "ER34101", "ER34201", "ER34301")))

names(InterviewNum) <- mapply(paste, "InterviewNum", c(1968:1997, seq(1999,2015, 2)), sep="_")
```

##PERSON NUMBER
```{r}
df$PersonNum <- df$ER30002
```


##RELATION TO HEAD
```{r}
RelationToHead <- df %>% select(one_of(c("ER30003", "ER30022", "ER30045", "ER30069", "ER30093", "ER30119", "ER30140", "ER30162", "ER30190", "ER30219", "ER30248", "ER30285", "ER30315", "ER30345", "ER30375", "ER30401", "ER30431", "ER30465", "ER30500", "ER30537", "ER30572", "ER30608", "ER30644", "ER30691", "ER30735", "ER30808", "ER33103", "ER33203", "ER33303", "ER33403", "ER33503", "ER33603", "ER33703", "ER33803", "ER33903", "ER34003", "ER34103", "ER34203", "ER34303")))

names(RelationToHead) <- mapply(paste, "RelationToHead", c(1968:1997, seq(1999,2015, 2)), sep="_")

```


##Sequence number
```{r}
SeqNum <- df %>% select(one_of(c("ER30021", "ER30044", "ER30068", "ER30092", "ER30118", "ER30139", "ER30161", "ER30189", "ER30218", "ER30247", "ER30284", "ER30314", "ER30344", "ER30374", "ER30400", "ER30430", "ER30464", "ER30499", "ER30536", "ER30571", "ER30607", "ER30643", "ER30690", "ER30734", "ER30807", "ER33102", "ER33202", "ER33302", "ER33402", "ER33502", "ER33602", "ER33702", "ER33802", "ER33902", "ER34002", "ER34102", "ER34202", "ER34302")))

names(SeqNum) <- mapply(paste, "SeqNum", c(1969:1997, seq(1999,2015, 2)), sep="_")
```


##Sampling error cluster
```{r}
df$SampErrClust <- df$ER31997

```

##Sampling error stratum
```{r}
df$SampErrStrat <- df$ER31996

```


#Combine everything

```{r}

colgroups <- ls()

AnalysisData_Wide <- cbind(df[,c("ID", "SampErrClust", "SampErrStrat", "Sex")], bind_cols(mget(colgroups[!(colgroups %in% c("df", "RAW"))])))


save(AnalysisData_Wide, file="/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/AnalysisData_Wide.Rdata")

rm(list=ls())

```

#Wide to long
```{r}

load("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/AnalysisData_Wide.Rdata")

library(beepr)

AnalysisData <- AnalysisData_Wide %>% 
                      gather(key=var, value=val, -ID, -SampErrClust, -SampErrStrat, -Sex) %>%
                      separate(var, c("Variable", "Year"), "_")


AnalysisData <- AnalysisData %>% spread(Variable, val)

save(AnalysisData, file="/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/AnalysisData.Rdata")
beep()
```


# Before restricting, get spouse's income info to make composite variable

```{r}

library(tidyverse)

load("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/AnalysisData.Rdata")

AnalysisData$SpouseIncome1 <- AnalysisData$TotalLaborIncome1.Spouse
AnalysisData$SpouseIncome2<-AnalysisData$TotalLaborIncome2.Spouse

``` 

#Restrict data to heads of household (since only they are asked K6)

```{r}

df <- AnalysisData %>% 
                    dplyr::select(-contains(".Spouse")) %>% 
                    filter(RelationToHead==10)
```

#For every respondent from 2003-2015 (when K6 asked), go back as far as their first year of participation - 1983
```{r}
UniqueIDs <- df %>% filter(Year %in% c("2003", "2005", "2007", "2009", "2011", "2013", "2015"))
UniqueIDs <- unique(UniqueIDs$ID)
df <- df %>% filter(ID %in% UniqueIDs)
df$ID<-as.factor(df$ID)

#df %>% group_by(Year) %>% summarize(max(Age.Head, na.rm=TRUE))

```

     

#Check variable value options for Qs asked every year
```{r}
# Recode Age

df$Year <- as.numeric(df$Year)

df <- df %>% mutate(Age.Head = ifelse(Year %in% c(1983:1993) & Age.Head>98, NA, ifelse(Year %in% c(1994:1996) &
                                  Age.Head %in% c(0,98,99), NA, ifelse(Year %in% c(1997:2015) & Age.Head > 120, NA,
                                  Age.Head))))
                    
                    
```                    
                    


# Recode industries and occupations into standard groups, 1970s codes and 2000s codes, collapse into one variable

## Create Categortical Industry Variable

```{r}

df <- df %>% mutate(Industry_Cat = case_when(
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(17:28) ~ "Agra/Forest/Fish",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(47:57) ~ "Mining",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(67:77) ~ "Construction",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(107:398) ~ "Manufacturing",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(407:479) ~ "Transport/Comm/PubUtil",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(507:698) ~ "Whole/Retail Trade",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(707:718) ~ "Finance/Insur/RealEstate",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(727:759) ~ "BusinessRepairServices",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(769:798) ~ "PersonalServices",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(807:809) ~ "Entertain/Rec Services",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(828:897) ~ "Pro/Related Services",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(907:937) ~ "Public Admin",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(999, 0, 998, NA) ~ "Unknown",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(17:29) ~ "Agra/Forest/Fish",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(37:49) ~ "Mining",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(57:69) ~ "Utilities",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(77) ~ "Construction",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(107:399) ~ "Manufacturing",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(407:459) ~ "Wholesale Trade",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(467:579) ~ "Retail Trade",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(607:639) ~ "Transport/Warehousing",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(647:679) ~ "Information",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(687:699) ~ "Finance/Insurance",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(707:719) ~ "Real Estate",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(727:749) ~ "Pro/Sci/Tech Services",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(757:779) ~ "Mgmt/Admin/Waste Services",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(786:789) ~ "Educ Services",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(797:847) ~ "Healthcare/Social Services",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(856:859) ~ "Arts/Entertain/Rec",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(866:869) ~ "Accom/Food Services",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(877:929) ~ "Other Services",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(937:987) ~ "Public Admin/Military",
  .$Year %in% c(2003:2015) & .$Industry.Head %in% c(848, 999, 0, NA) ~ "Unknown")
)



```

## Create Change in Industry Variable

```{r}
df <- df %>% group_by(ID) %>% 
  mutate(Industry_Change_83_01 = if_else(Year %in% c(1983:2001) & Industry_Cat != lag(Industry_Cat), 1, 0)) %>% 
  group_by(ID) %>% 
  mutate(N_Change_Industry_Prior = sum(Industry_Change_83_01, na.rm = TRUE))


```

## Create modal Industry prior to 2003 variable

```{r}

Modal_Industry_Baseline <- df %>% 
  group_by(ID) %>% 
  filter(Year %in% c(1983:2001)) %>% 
  count(Industry_Cat) %>% 
  dplyr::slice(which.max(n)) %>% 
  transmute(Industry_Baseline = Industry_Cat) 

df <- left_join(df, Modal_Industry_Baseline, by="ID")

df <- ungroup(df)

```


## Create Categortical Occupation Variable

```{r}

df <- df %>% mutate(Occupation_Cat = case_when(
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(1:95) ~ "Pro/Tech/Kindred",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(201:245) ~ "Managers/Administrators",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(260:285) ~ "Sales",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(301:395) ~ "Clerical/Kindred",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(401:600) ~ "Crafts/Kindred",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(601:695) ~ "Operatives",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(701:715) ~ "Transport",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(740:785) ~ "Laborers",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(801:802) ~ "Farmers/Farm Managers",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(821:824) ~ "Farm Laborers/Foremen",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(901:965) ~ "Service Workers",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(980:984) ~ "PrivateHousehold Workers",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(0,999, 998, 810, NA) ~ "Unknown",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(1:42) ~ "Management",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(50:73) ~ "Business Ops Specialists",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(80:95) ~ "Financial Specialists",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(100:124) ~ "Computer/Mathematical",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(130:156) ~ "Architect/Engineering",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(160:196) ~ "Life/Phys/Soc Sciences",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(200:206) ~ "Community/Social Services",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(210:215) ~ "Legal",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(220:255) ~ "Educ/Training/Library",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(260:296) ~ "Arts/Media/Sports/Entertainment",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(300:354) ~ "Healthcare",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(370:395) ~ "Protective Services",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(400:416) ~ "Food Prep/Serving",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(420:425) ~ "Building/Grounds/Maintenance",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(430:465) ~ "Personal Care",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(470:496) ~ "Sales",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(500:593) ~ "Office/Admin Support",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(600:613) ~ "Farm/Fish/Forest",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(620:676) ~ "Construction",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(680:694) ~ "Extraction",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(700:762) ~ "Install/Maint/Repair",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(770:896) ~ "Production",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(900:975) ~ "Transportation/Material Moving",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(980:983) ~ "Military",
  .$Year %in% c(2003:2015) & .$Occupation.Head %in% c(615,999,0,998, NA) ~ "Unknown"))



```



## Create Change in Occupation Variable

```{r}
df <- df %>% group_by(ID) %>% 
  mutate(Occupation_Change_83_01 = if_else(Year %in% c(1983:2001) & Occupation_Cat != lag(Occupation_Cat), 1, 0)) %>% 
  group_by(ID) %>% 
  mutate(N_Change_Occupation_Prior = sum(Occupation_Change_83_01, na.rm = TRUE))


```

## Create modal Occupation prior to 2003 variable

```{r}

Modal_Occupation_Baseline <- df %>% 
  group_by(ID) %>% 
  filter(Year %in% c(1983:2001)) %>% 
  count(Occupation_Cat) %>% 
  dplyr::slice(which.max(n)) %>% 
  transmute(Occupation_Baseline = Occupation_Cat) 

df <- left_join(df, Modal_Occupation_Baseline, by="ID")

df <- ungroup(df)

```

# Recode Race Variable

```{r}
df1 <- df %>% mutate(Race_cat = case_when(
  Race.Head == 1 ~ "White",
  Race.Head %in% c(2:5) ~ "POC",
  Race.Head == 7 ~ "Other",
  Race.Head %in% c(0,9,NA) ~ "Unknown"
))

df1$Race_cat <- factor(df1$Race_cat, levels = c("White", "POC", "Other", "Unknown"))
```


# Baseline variables                   
## Depression, Drug, Emotional Prob, Poor Health before 17

The "before 17" variables seem to have a complicated skip pattern, where you only get the module once and so future waves you might be missing. Going to treat these as "if you ever answered, that's your answer"

```{r, eval = TRUE}

df1 <- df1 %>% mutate(Depressed17 = case_when(
            Depressed17.Head == 5 ~ "No",
              Depressed17.Head == 1 ~ "Yes",
              Depressed17.Head %in% c(0,8,9, NA) ~ "Unknown"),
            DrugProb17 = case_when(
              DrugProb17.Head == 5 ~ "No",
              DrugProb17.Head == 1 ~ "Yes",
              DrugProb17.Head %in% c(0,8,9, NA) ~ "Unknown"),
            EmotProb = case_when(
              EmotProb.Head == 5 ~ "No",
              EmotProb.Head == 1 ~ "Yes",
              EmotProb.Head %in% c(0,8,9, NA) ~ "Unknown"),
            KidHealth = case_when(
              KidHealth.Head %in% c(1:3) ~ "No",
              KidHealth.Head %in% c(4,5) ~ "Yes",
              KidHealth.Head %in% c(0,8,9,NA) ~ "Unknown")) 

df1 <- df1 %>% 
  group_by(ID) %>% 
  mutate(Depressed.baseline = if_else(any(Depressed17=="Yes"), "Yes", if_else(any(Depressed17=="No"), "No", "Unknown")),
    DrugProb.baseline = if_else(any(DrugProb17=="Yes"), "Yes", if_else(any(DrugProb17=="No"), "No", "Unknown")),
    EmotProb.baseline = if_else(any(EmotProb=="Yes"), "Yes", if_else(any(EmotProb=="No"), "No", "Unknown")),
    KidHealth.baseline = if_else(any(KidHealth=="Yes"), "Yes", if_else(any(KidHealth=="No"), "No", "Unknown"))
    ) %>% 
  ungroup(df1)


```


## Alcohol use (also fix drinks per day variable)
```{r}

df1 <- df1 %>% 
  mutate(AlcFreq = as.factor(case_when(
      AlcFreq.Head == 0 ~ "Never",
      AlcFreq.Head == 1 ~ "<1perMnth",
      AlcFreq.Head == 2 ~ "1perMnth",
      AlcFreq.Head == 3 ~ ">1perMnth",
      AlcFreq.Head == 4 ~ "1perWeek",
      AlcFreq.Head == 5 ~ ">1perWeek",
      AlcFreq.Head == 6 ~ "EveryDay",
      AlcFreq.Head %in% c(8,9, NA) ~ "Unknown")),
    DrinksPerDay = as.factor(case_when(
      Year==2003 & DrinksPerDay.Head == 0 ~ "None",
      Year==2003 & DrinksPerDay.Head == 1 ~ "<1perDay",
      Year==2003 & DrinksPerDay.Head == 2 ~ "1:2perDay",
      Year==2003 & DrinksPerDay.Head == 3 ~ "3:4perDay",
      Year==2003 & DrinksPerDay.Head == 4 ~ ">=5perDay",
      Year==2003 & DrinksPerDay.Head %in% c(8,9, NA) ~ "Unknown",
      Year %in% c(2005:2015) & DrinksPerDay.Head == 0 ~ "None",
      Year %in% c(2005:2015) & DrinksPerDay.Head %in% c(1:2) ~ "1:2perDay",
      Year %in% c(2005:2015) & DrinksPerDay.Head %in% c(3:4) ~ "3:4perDay",
      Year %in% c(2005:2015) & DrinksPerDay.Head >=5 ~ ">=5perDay",
      Year %in% c(2005:2015) & DrinksPerDay.Head %in% c(98:99, NA) ~ "Unknown")))


```



## Did a doctor ever tell you that you have...
```{r}

df1 <- df1 %>% mutate(DrEmotProb = case_when(
  DrEmotProb.Head == 1 ~ "Yes",
  DrEmotProb.Head == 5 ~ "No",
  DrEmotProb.Head %in% c(8,9,0,NA) ~ "Unknown"),
  DrLearnDisord = case_when(
  DrLearnDisord.Head == 1 ~ "Yes",
  DrLearnDisord.Head == 5 ~ "No",
  DrLearnDisord.Head %in% c(8,9,0,NA) ~ "Unknown"),
  DrMemLoss = case_when(
  DrMemLoss.Head == 1 ~ "Yes",
  DrMemLoss.Head == 5 ~ "No",
  DrMemLoss.Head %in% c(8,9,0,NA) ~ "Unknown"))



df1 <- df1 %>% 
  group_by(ID) %>% 
  mutate(DrEmotProb.baseline = if_else(any(DrEmotProb=="Yes"), "Yes", if_else(any(DrEmotProb=="No"), "No", "Unknown")),
    DrLearnDisord.baseline = if_else(any(DrLearnDisord=="Yes"), "Yes", if_else(any(DrLearnDisord=="No"), "No", "Unknown")),
    DrMemLoss.baseline = if_else(any(DrMemLoss=="Yes"), "Yes", if_else(any(DrMemLoss=="No"), "No", "Unknown"))
    ) %>% 
  ungroup(df1)


```

##Employment Status

```{r}

df1 <- df1 %>% 
  mutate(EmploymentStatus = case_when(
EmployedNow2.Head == 1 ~ "Working",
EmployedNow2.Head == 2  ~ "TempNotWork",
EmployedNow2.Head == 3  ~ "Looking/Unempl",
EmployedNow2.Head == 4  ~ "Retired",
EmployedNow2.Head == 5  ~ "Disabled",
EmployedNow2.Head == 6  ~ "Keeping house",
EmployedNow2.Head == 7  ~ "Student",
EmployedNow2.Head == 8  ~ "Other",
EmployedNow2.Head %in% c(0,9,98,99, NA)   ~ "Unknown"))

df1 <- df1 %>% mutate(EmploymentStatus = replace_na(EmploymentStatus, "Unknown"))
```

## Change in Employement Status prior to 2003

```{r}
df1 <- df1 %>% group_by(ID) %>% 
  mutate(EmployStatusChange_to_01 = if_else(Year < 2003 & EmploymentStatus != lag(EmploymentStatus), 1, 0)) %>% 
  group_by(ID) %>% 
  mutate(N_Change_Employ_Prior = sum(EmployStatusChange_to_01, na.rm = TRUE)) %>% 
  ungroup(df1)


df1 <- select(df1, -EmployStatusChange_to_01)

```

## Create modal baseline employment status

```{r}

Modal_EmployStatus_Baseline <- df1 %>% 
  group_by(ID) %>% 
  filter(Year < 2003) %>% 
  count(EmploymentStatus) %>% 
  dplyr::slice(which.max(n)) %>% 
  transmute(EmploymentStatus.baseline = EmploymentStatus) 

df1 <- left_join(df1, Modal_EmployStatus_Baseline, by="ID")

df1 <- ungroup(df1)

```


## Ever smoked


```{r}

df1$EverSmoked <-ifelse(df1$EverSmoked.Head ==1, "Yes", ifelse(df1$EverSmoked.Head ==5, "No", ifelse(df1$EverSmoked.Head %in% c(8,9, NA), "Unknown", ifelse(df1$EverSmoked.Head == 0, "Yes Currently", NA))))


```

## Family size          

```{r}
df1$FamilySize<-ifelse(df1$FamilySize < 99, df1$FamilySize, NA)

Mean_Fam_Size <- df1 %>% group_by(ID) %>% 
  filter(Year < 2003) %>% 
  summarise(Baseline_Mean_Fam_Size = mean(FamilySize, na.rm = TRUE)) %>%  
  ungroup(df1)

df1 <- left_join(df1, Mean_Fam_Size, by="ID")

```

## General Health
```{r}

df1 <- df1 %>% 
  mutate(GenHealth = case_when(
              GenHealth.Head %in% c(1:3) ~ "No",
              GenHealth.Head %in% c(4,5) ~ "Yes",
              GenHealth.Head %in% c(0,8,9,NA) ~ "Unknown")) 

df1 <- df1 %>% 
  group_by(ID) %>% 
  mutate(GenHealth.baseline = if_else(any(GenHealth=="Yes"), "Yes", if_else(any(GenHealth=="No"), "No", "Unknown"))
    ) %>% 
  ungroup(df1)



```

## Grades Completed

```{r}
#lt high school, 12=high school, 13-15 = some college, 16=college, 17=more than college

df1 <- df1 %>% mutate(GradesCompl = case_when(
  GradesCompl %in% c(1:11) ~ "<HS",
  GradesCompl == 12 ~ "HS",
  GradesCompl %in% c(13:15) ~ "Some College",
  GradesCompl == 16 ~ "College",
  GradesCompl == 17 ~ ">College",
  GradesCompl %in% c(0,99,NA) ~ "Unknown"))

```

##InterestIncome, and baseline

```{r}

df1$InterestIncome <- ifelse(is.na(df1$InterestIncome.Head), 0, df1$InterestIncome.Head)

##baseline
df1$InterestIncome.2003<-ifelse(df1$Year<2003, df1$InterestIncome.Head, NA)

df1.interest<- df1 %>%
    group_by(ID) %>%
    dplyr::summarize(InterestIncome.baseline = mean(InterestIncome.2003, na.rm=TRUE))
#merge back
df1<-merge(df1, df1.interest, by="ID", all.y="TRUE", all.x="TRUE")

df1 <- df1 %>% mutate(InterestIncome.baseline = replace_na(InterestIncome.baseline, 0))
```


## Own or rent, and modale baseline own/rent

```{r}

df1 <- df1 %>% mutate(OwnRent = case_when(
  OwnRent == 1 ~ "Owns",
  OwnRent == 5 ~ "Rents",
  OwnRent == 8 ~ "Neither",
  OwnRent %in% c(0,9,NA) ~ "Unknown"
))

Modal_OwnRent_Baseline <- df1 %>% 
  group_by(ID) %>% 
  filter(Year < 2003) %>% 
  count(OwnRent) %>% 
  dplyr::slice(which.max(n)) %>% 
  transmute(OwnRent.baseline = OwnRent) 

df1 <- left_join(df1, Modal_OwnRent_Baseline, by="ID")

df1 <- ungroup(df1)
```

## Self-employed

```{r}

df1 <- df1 %>% mutate(SelfEmployed = case_when(
  SelEmp2001.Head == 1 ~ "SomeoneElse",
  SelEmp2001.Head == 2 ~ "Both",
  SelEmp2001.Head == 3 ~ "Self",
  SelEmp2001.Head %in% c(0,9,NA) ~ "Unknown"
))


Years_Self_Empl <- df1 %>% group_by(ID) %>% 
  filter(Year < 2003) %>% 
  count(SelfEmployed) %>% 
  filter(SelfEmployed=="Self") %>% 
  rename(Yrs_Self_Emp = n)

df1 <- left_join(df1, Years_Self_Empl, by=c("ID", "SelfEmployed"))


df1 <- df1 %>% mutate(Yrs_Self_Emp = replace_na(Yrs_Self_Emp, 0))

```

##TotalLaborIncome.Head not recoded - continuous
```{r}
##TotalLaborIncome.Head not recoded - continuous

## Baseline - average

df1$TotalLaborIncome.2003<-ifelse(df1$Year<2003, df1$TotalLaborIncome.Head, NA)

df1.labor<- df1 %>%
    group_by(ID) %>%
    dplyr::summarize(TotalLaborIncome.baseline = mean(TotalLaborIncome.2003, na.rm=TRUE))
#merge back
df1<-merge(df1, df1.labor, by="ID", all.y="TRUE", all.x="TRUE")

df1$TotalLaborIncome <- df1$TotalLaborIncome.Head

```

## salary or hourly

```{r}
load("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/Hourly/Hourly_Long.Rdata")

df1$ID <- as.character(df1$ID)
Hourly_Long$ID <- as.character(Hourly_Long$ID)
df1$Year <- as.character(df1$Year)

df1_wage_type <- left_join(df1, Hourly_Long, by = c("ID" = "ID", "Year" = ".time_1"))
```

## Spouse labor income 

```{r}


#table(df1$SpouseIncome1, df1$Year) # thru 1993
#table(df1$SpouseIncome2, df1$Year) #1994 and up

df1$SpouseIncome<-ifelse(df1$Year <1994, df1$SpouseIncome1, ifelse(df1$Year %in% c(1994:2018), df1$SpouseIncome2, NA))
## Baseline - average
df1$SpouseIncome.2003<-ifelse(df1$Year<2003, df1$SpouseIncome, NA)

df1.spouseincome<- df1 %>%
    group_by(ID) %>%
    dplyr::summarize(SpouseIncome.baseline = mean(SpouseIncome.2003, na.rm=TRUE))
#merge back
df1<-left_join(df1, df1.spouseincome, by="ID")


df1 <- df1 %>% mutate(SpouseIncome = replace_na(SpouseIncome, 0),
                      SpouseIncome.baseline = replace_na(SpouseIncome.baseline, 0))

df1 <- select(df1, -SpouseIncome1, -SpouseIncome2)
```

## Years covered by union baseline
```{r}


df1 <- df1 %>% mutate(UnionCovered = case_when(
  UnionCovered.Head == 1 ~ "Yes",
  UnionCovered.Head == 5 ~ "No",
  UnionCovered.Head %in% c(0,8,9,NA) ~ "Unknown"
))


Years_Union_Covered <- df1 %>% group_by(ID) %>% 
  filter(Year < 2003) %>% 
  count(UnionCovered) %>% 
  filter(UnionCovered=="Yes") %>% 
  rename(Yrs_Union_Cov = n)

df1 <- left_join(df1, Years_Union_Covered, by=c("ID", "UnionCovered"))

df1 <- df1 %>% mutate(Yrs_Union_Cov = replace_na(Yrs_Union_Cov, 0))

```

## Years worked baseline

```{r}

df1$YearsWorked <- ifelse(df1$YearsWorked.Head %in% c(0:98), df$YearsWorked.Head, NA)  
#baseline


YearsWorkd_Baseline <- df1 %>% 
  group_by(ID) %>% 
  filter(Year < 2003) %>% 
  summarise(YearsWorked.baseline = mean(YearsWorked.Head, na.rm=TRUE)) 

df1 <- left_join(df1, YearsWorkd_Baseline, by="ID")

```

## Work hours baseline

```{r}

df1$WorkHrs <- df1$WorkHrs.Head

##baseline

WorkHours_Baseline <- df1 %>% 
  group_by(ID) %>% 
  filter(Year < 2003) %>% 
  summarise(WorkHrs.baseline = mean(WorkHrs.Head, na.rm=TRUE)) 

df1 <- left_join(df1, WorkHours_Baseline, by="ID")

```


# Create MMI and SMI

```{r}


df1$SMI <- ifelse(df1$K6.Head>=13 & df1$K6.Head!=99, 1, ifelse(!is.na(df1$K6.Head), 0, NA))
df1$MMI <- ifelse(df1$K6.Head>=5 & df1$K6.Head<13 & df1$K6.Head!=99, 1, ifelse(!is.na(df1$K6.Head), 0, NA))


```



# CREATE DIFFERENT DEFINITIONS OF EXPLOITATION BASED ON HOURS PER YEAR

# Filter data to remove the 1% and to keep only people working full time in given year


```{r}

df1 <- df1 %>% filter(TotalLaborIncome < quantile(TotalLaborIncome, 0.99, na.rm=TRUE) &  TotalLaborIncome > 0 & WorkHrs >= 2040) 

```



# Create exploitation variable

```{r}
df1$HourlyWage40 <- ifelse(df1$WorkHrs>=2040 , (df1$TotalLaborIncome)/2040, NA)

df1$TrueHourlyWage <- ifelse(df1$WorkHrs>=2040, (df1$TotalLaborIncome)/(df1$WorkHrs), NA)

df1$Exploitation <- (df1$HourlyWage40 - df1$TrueHourlyWage) / df1$HourlyWage40

```

# Create baseline average exploitation

```{r}

Ave_Exploit_Baseline <- df1 %>% 
  group_by(ID) %>% 
  filter(Year %in% c(1983:2001)) %>% 
  transmute(Exploit_Baseline = mean(Exploitation, na.rm = TRUE)) 

df1 <- left_join(df1, Ave_Exploit_Baseline, by="ID")

df1 <- ungroup(df1)

```





# Drop unneeded variables and save

```{r, eval=TRUE}

df1$Race <- df1$Race.Head
df1$K6 <- df1$K6.Head

df1 <- df1 %>% select_at(vars(-contains("2003"), -contains("Head")))

df1 <- df1 %>% select(-SampErrClust, -SampErrStrat, -Insurance2, -InterviewNum, -Medicaid, -SampWeight1996, -SampWeight2015, -SampWeight9396Rev, -SeqNum, -Industry_Change_83_01, -Occupation_Change_83_01, -HealthInsNow )

#df1 <- df1 %>% rename_all(~str_replace_all(., ".Head", ""))

df1 <- filter(df1, Year %in% c(2003:2015))



df1[,sapply(df1, is.character)] <- lapply(df1[,sapply(df1, is.character)], as.factor)


IPW_MSM_AnalysisData <- df1



save(IPW_MSM_AnalysisData, file="/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/IPW_MSM_AnalysisData.RData")


names(IPW_MSM_AnalysisData)
```





