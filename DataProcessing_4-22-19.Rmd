---
title: "Data Processing"
output: html_notebook
---


```{r, setup}

library(tidyverse)
```


#Import CSV, create ID var
```{r, eval=FALSE}

RAW <- read_csv("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/data2017.csv")
```

```{r, eval=FALSE}
df <- RAW

df$ID <- df$ER30001 * 1000 + df$ER30002
```

# Merge Head Hourly/Salaried data

```{r, eval=FALSE}
library(rio)
hourly <- import("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/HourlyUpdate/J259614.dbf")

hourly$ID <- hourly$ER30001 * 1000 + hourly$ER30002

df <- left_join(df, hourly)

rm(hourly)
```


#RENAME VARIABLES
##Age Head
```{r, eval=FALSE}
Age.Head <- df %>% select(one_of(c("V117", "V1008", "V1239", "V1942", "V2542", "V3095", "V3508", "V3921", "V4436", "V5350", "V5850", "V6462", "V7067", "V7658", "V8352", "V8961", "V10419", "V11606", "V13011", "V14114", "V15130", "V16631", "V18049", "V19349", "V20651", "V22406", "ER2007", "ER5006", "ER7006", "ER10009", "ER13010", "ER17013", "ER21017", "ER25017", "ER36017", "ER42017", "ER47317", "ER53017", "ER60017", "ER66017")))

names(Age.Head) <- mapply(paste, "Age.Head", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Age Spouse
```{r, eval=FALSE}
Age.Spouse <- df %>% select(one_of(c("V118", "V1011", "V1241", "V1944", "V2544", "V3097", "V3510", "V3923", "V4438", "V5352", "V5852", "V6464", "V7069", "V7660", "V8354", "V8963", "V10421", "V11608", "V13013", "V14116", "V15132", "V16633", "V18051", "V19351", "V20653", "V22408", "ER2009", "ER5008", "ER7008", "ER10011", "ER13012", "ER17015", "ER21019", "ER25019", "ER36019", "ER42019", "ER47319", "ER53019", "ER60019", "ER66019")))

names(Age.Spouse) <- mapply(paste, "Age.Spouse", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Race Head
```{r, eval=FALSE}
Race.Head <- df %>% select(one_of(c("V181", "V801", "V1490", "V2202", "V2828", "V3300", "V3720", "V4204", "V5096", "V5662", "V6209", "V6802", "V7447", "V8099", "V8723", "V9408", "V11055", "V11938", "V13565", "V14612", "V16086", "V17483", "V18814", "V20114", "V21420", "V23276", "ER3944", "ER6814", "ER9060", "ER11848", "ER15928", "ER19989", "ER23426", "ER27393", "ER40565", "ER46543", "ER51904", "ER57659", "ER64810", "ER70882")))

names(Race.Head) <- mapply(paste, "Race.Head", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```


##Race Spouse
```{r, eval=FALSE}
Race.Spouse <- df %>% select(one_of(c("V12293", "V13500", "V14547", "V16021", "V17418", "V18749", "V20049", "V21355", "V23212", "ER3883", "ER6753", "ER8999", "ER11760", "ER15836", "ER19897", "ER23334", "ER27297", "ER40472", "ER46449", "ER51810", "ER57549", "ER64671", "ER70744")))

names(Race.Spouse) <- mapply(paste, "Race.Spouse", c(seq(1985, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```


##Family composition change variable
```{r, eval=FALSE}
FamilyComp <- df %>% select(one_of(c("V542", "V1109", "V1809", "V2410", "V3010", "V3410", "V3810", "V4310", "V5210", "V5710", "V6310", "V6910", "V7510", "V8210", "V8810", "V10010", "V11112", "V12510", "V13710", "V14810", "V16310", "V17710", "V19010", "V20310", "V21608", "ER2005A", "ER5004A", "ER7004A", "ER10004A", "ER13008A", "ER17007", "ER21007", "ER25007", "ER36007", "ER42007", "ER47307", "ER53007", "ER60007", "ER66007")))

names(FamilyComp) <- mapply(paste, "FamilyComp", c(seq(1969, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Family Size
```{r, eval=FALSE}
FamilySize <- df %>% select(one_of(c("V115", "V549", "V1238", "V1941", "V2541", "V3094", "V3507", "V3920", "V4435", "V5349", "V5849", "V6461", "V7066", "V7657", "V8351", "V8960", "V10418", "V11605", "V13010", "V14113", "V15129", "V16630", "V18048", "V19348", "V20650", "V22405", "ER2006", "ER5005", "ER7005", "ER10008", "ER13009", "ER17012", "ER21016", "ER25016", "ER36016", "ER42016", "ER47316", "ER53016", "ER60016", "ER66016")))

names(FamilySize) <- mapply(paste, "FamilySize", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```
##Do you drink alcohol head

```{r, eval=FALSE}
AlcUse.Head <- df %>% select(one_of(c("ER15550", "ER19715", "ER23130", "ER27105", "ER38316", "ER44289", "ER49627", "ER55375", "ER62497", "ER68562")))
names(AlcUse.Head) <- mapply(paste, "AlcUse.Head", seq(1999, 2017, 2), sep = "_")
```
##Alcohol Use Frequency Head
```{r, eval=FALSE}
AlcFreq.Head <- df %>% select(one_of(c("ER27106", "ER38317", "ER44290", "ER49628", "ER55376", "ER62498", "ER68563")))

names(AlcFreq.Head) <- mapply(paste, "AlcFreq.Head", seq(2005, 2017, 2), sep = "_")
```

##Alcohol Use Frequency Spouse
```{r, eval=FALSE}
AlcFreq.Spouse <- df %>% select(one_of(c("ER27229", "ER39414", "ER45387", "ER50746", "ER56492", "ER63614", "ER69690")))

names(AlcFreq.Spouse) <- mapply(paste, "AlcFreq.Spouse", seq(2005, 2017, 2), sep = "_")
```


##Alcohol drinks per day head
```{r, eval=FALSE}
DrinksPerDay.Head <- df %>% select(one_of(c("ER15551", "ER19716", "ER23131", "ER27107", "ER38318", "ER44291", "ER49629", "ER55377", "ER62499", "ER68564")))

names(DrinksPerDay.Head) <- mapply(paste, "DrinksPerDay.Head", seq(1999, 2017, 2), sep = "_")
```

##Alcohol drinks per day spouse
```{r, eval=FALSE}
DrinksPerDay.Spouse <- df %>% select(one_of(c("ER15659", "ER19824", "ER23258", "ER27230", "ER39415", "ER45388", "ER50747", "ER56493", "ER63615", "ER69691")))

names(DrinksPerDay.Spouse) <- mapply(paste, "DrinksPerDay.Spouse", seq(1999, 2017, 2), sep = "_")
```

##Alcohol days with 5 or more drinks head
```{r, eval=FALSE}
Drink5.Head <- df %>% select(one_of(c("ER27108", "ER38319", "ER44292", "ER49630", "ER55378", "ER62500", "ER68565")))

names(Drink5.Head) <- mapply(paste, "Drink5.Head", seq(2005, 2017, 2), sep = "_")
```

##Alcohol days with 4 or more drinks spouse
```{r, eval=FALSE}
Drink5.Spouse <- df %>% select(one_of(c("ER27231", "ER39416", "ER45389", "ER50748", "ER56494", "ER63616", "ER69692")))

names(Drink5.Spouse) <- mapply(paste, "Drink5.Spouse", seq(2005, 2017, 2), sep = "_")
```

##Ever smoked head
```{r, eval=FALSE}
EverSmoked.Head <- df %>% select(one_of(c("V13444", "ER15546", "ER19711", "ER23126", "ER27101", "ER38312", "ER44285", "ER49623", "ER55371", "ER62493", "ER68558")))

names(EverSmoked.Head) <- mapply(paste, "EverSmoked.Head", c(1986, seq(1999, 2017, 2)), sep = "_")
```

##Ever smoked spouse
```{r, eval=FALSE}
EverSmoked.Spouse <- df %>% select(one_of(c("V13479", "ER15654", "ER19819", "ER23253", "ER27224", "ER39409", "ER45382", "ER50741", "ER56487", "ER63609", "ER69685")))

names(EverSmoked.Spouse) <- mapply(paste, "EverSmoked.Spouse", c(1986, seq(1999, 2017, 2)), sep = "_")
```

##Depression before age 17 head
```{r, eval=FALSE}
Depressed17.Head <- df %>% select(one_of(c("ER38341", "ER44314", "ER49654", "ER55402", "ER62524", "ER68589")))

names(Depressed17.Head) <- mapply(paste, "Depressed17.Head", seq(2007, 2017, 2), sep = "_")
```

##Depression before age 17 spouse
```{r, eval=FALSE}
Depressed17.Spouse <- df %>% select(one_of(c("ER39438", "ER45411", "ER50772", "ER56518", "ER63640", "ER69716")))

names(Depressed17.Spouse) <- mapply(paste, "Depressed17.Spouse", seq(2007, 2017, 2), sep = "_")
```

##Drug or alc problem before 17 head
```{r, eval=FALSE}
DrugProb17.Head <- df %>% select(one_of(c("ER38342", "ER44315", "ER49655", "ER55403", "ER62525", "ER68590")))

names(DrugProb17.Head) <- mapply(paste, "DrugProb17.Head", seq(2007, 2017, 2), sep = "_")
```

##Drug or alc problem before 17 spouse
```{r, eval=FALSE}
DrugProb17.Spouse <- df %>% select(one_of(c("ER39439", "ER45412", "ER50773", "ER56519", "ER63641", "ER69717")))

names(DrugProb17.Spouse) <- mapply(paste, "DrugProb17.Spouse", seq(2007, 2017, 2), sep = "_")
```

##Health Status Growing Up head
```{r, eval=FALSE}
KidHealth.Head <- df %>% select(one_of(c("ER38323", "ER44296", "ER49636", "ER55384", "ER62506", "ER68571")))

names(KidHealth.Head) <- mapply(paste, "KidHealth.Head", seq(2007, 2017, 2), sep = "_")
```

##Health Status Growing Up spouse
```{r, eval=FALSE}
KidHealth.Spouse <- df %>% select(one_of(c("ER39420", "ER45393", "ER50754", "ER56500", "ER63622", "ER69698")))

names(KidHealth.Spouse) <- mapply(paste, "KidHealth.Spouse", seq(2007, 2017, 2), sep = "_")
```

##Other emotional/psychologic problems head
```{r, eval=FALSE}
EmotProb.Head <- df %>% select(one_of(c("ER38343", "ER44316", "ER49656", "ER55404", "ER62526", "ER68591")))

names(EmotProb.Head) <- mapply(paste, "EmotProb.Head", seq(2007, 2017, 2), sep = "_")
```

##Other emotional/psychologic problems spouse
```{r, eval=FALSE}
EmotProb.Spouse <- df %>% select(one_of(c("ER39440", "ER45413", "ER50774", "ER56520", "ER63642", "ER69718")))

names(EmotProb.Spouse) <- mapply(paste, "EmotProb.Spouse", seq(2007, 2017, 2), sep = "_")
```

##Health insurance coverage in last 2 years anyone in family
```{r, eval=FALSE}
Insurance2 <- df %>% select(one_of(c("ER15779", "ER19840", "ER23277", "ER27237", "ER40409", "ER46382", "ER51743")))

names(Insurance2) <- mapply(paste, "Insurance2", seq(1999, 2011, 2), sep = "_")
```


##Health insurance head + family
```{r, eval=FALSE}
InsuranceHeadFam <- df %>% select(one_of(c("V158", "V740", "V1406", "V2118", "V2715", "V7287")))

names(InsuranceHeadFam) <- mapply(paste, "InsuranceHeadFam", c(seq(1968, 1972, 1), 1980), sep = "_")
```


##Medicaid/medicare anyone in family
```{r, eval=FALSE}
Medicaid <- df %>% select(one_of(c("V6686", "V7289", "V7989", "V9299", "V10890", "V11997", "V13448", "V14520", "V15997", "V17394", "V18725", "V20025", "V21326", "V23185", "ER3857", "ER6727", "ER8973")))

names(Medicaid) <- mapply(paste, "Medicaid", c(1979, 1980, 1981, seq(1983, 1996, 1)), sep = "_")
```


##K6
```{r, eval=FALSE}
K6.Head <- df %>% select(one_of(c("ER19833A", "ER23268", "ER40402", "ER46375", "ER51736", "ER57482", "ER64604", "ER70680")))

names(K6.Head) <- mapply(paste, "K6.Head", c(2001, 2003, seq(2007, 2017, 2)), sep = "_")
```


##Doctor told you emotional, nervous, psych problems head
```{r, eval=FALSE}
DrEmotProb.Head <- df %>% select(one_of(c("ER15494", "ER19659", "ER23059", "ER27045", "ER38256", "ER44229", "ER49562", "ER55311", "ER62433", "ER68487")))

names(DrEmotProb.Head) <- mapply(paste, "DrEmotProb.Head", seq(1999, 2017, 2), sep = "_")
```


##Age when doctor told you emotional, nervous, psych problems head
```{r, eval=FALSE}
AgeDrEmotProb.Head <- df %>% select(one_of(c("ER27046", "ER38257", "ER44230", "ER49564", "ER55312", "ER62434", "ER68488")))

names(AgeDrEmotProb.Head) <- mapply(paste, "AgeDrEmotProb.Head", seq(2005, 2017, 2), sep = "_")
```


##Medication if doctor told you emotional, nervous, psych problems head
```{r, eval=FALSE}
MedforPsych.Head <- df %>% select(one_of(c("ER49572", "ER55320", "ER62442", "ER68496")))

names(MedforPsych.Head) <- mapply(paste, "MedforPsych.Head", seq(2011, 2017, 2), sep = "_")
```


##Condition if doctor told you emotional, nervous, psych problems head
```{r, eval=FALSE}
ConditionPsych.Head <- df %>% select(one_of(c("ER27047", "ER38258", "ER44231", "ER49565", "ER55313", "ER62435", "ER68489")))

names(ConditionPsych.Head) <- mapply(paste, "ConditionPsych.Head", seq(2005, 2017, 2), sep = "_")
```


##Doctor told you emotional, nervous, psych problems Spouse
```{r, eval=FALSE}
DrEmotProb.Spouse <- df %>% select(one_of(c("ER15602", "ER19767", "ER23186", "ER27168", "ER39353", "ER45326", "ER50680", "ER56427", "ER63549", "ER69614")))

names(DrEmotProb.Spouse) <- mapply(paste, "DrEmotProb.Spouse", seq(1999, 2017, 2), sep = "_")
```


##Age when doctor told you emotional, nervous, psych problems Spouse
```{r, eval=FALSE}
AgeDrEmotProb.Spouse <- df %>% select(one_of(c("ER27169", "ER39354", "ER45327", "ER50682", "ER56428", "ER63550", "ER69615")))

names(AgeDrEmotProb.Spouse) <- mapply(paste, "AgeDrEmotProb.Spouse", seq(2005, 2017, 2), sep = "_")
```


##Medication if doctor told you emotional, nervous, psych problems Spouse
```{r, eval=FALSE}
MedforPsych.Spouse <- df %>% select(one_of(c("ER50690", "ER56436", "ER63558", "ER69623")))

names(MedforPsych.Spouse) <- mapply(paste, "MedforPsych.Spouse", seq(2011, 2017, 2), sep = "_")
```


##Condition if doctor told you emotional, nervous, psych problems Spouse
```{r, eval=FALSE}
ConditionPsych.Spouse <- df %>% select(one_of(c("ER27170", "ER39355", "ER45328", "ER50683", "ER56429", "ER63551", "ER69616")))

names(ConditionPsych.Spouse) <- mapply(paste, "ConditionPsych.Spouse", seq(2005, 2017, 2), sep = "_")
```


##Doctor told you learning disorder head
```{r, eval=FALSE}
DrLearnDisord.Head <- df %>% select(one_of(c("ER15518", "ER19683", "ER23083", "ER27034", "ER38245", "ER44218", "ER49548", "ER55298", "ER62420", "ER68474")))

names(DrLearnDisord.Head) <- mapply(paste, "DrLearnDisord.Head", seq(1999, 2017, 2), sep = "_")
```

##Age when doctor told you had learning disorder head

```{r, eval=FALSE}
AgeDrLearnDisord.Head <- df %>% select(one_of(c("ER27035", "ER38246", "ER44219", "ER49550", "ER55300", "ER62422", "ER68476")))

names(AgeDrLearnDisord.Head) <- mapply(paste, "AgeDrLearnDisord.Head", seq(2005, 2017, 2), sep = "_")
```


##Medication if doctor told you had learning disorder head
```{r, eval=FALSE}
MedLearnDisord.Head <- df %>% select(one_of(c("ER49552", "ER55302", "ER62424", "ER68478")))

names(MedLearnDisord.Head) <- mapply(paste, "MedLearnDisord.Head", seq(2011, 2017, 2), sep = "_")
```

##Doctor told you learning disorder Spouse
```{r, eval=FALSE}
DrLearnDisord.Spouse <- df %>% select(one_of(c("ER15626", "ER19791", "ER23210", "ER27157", "ER39342", "ER45315", "ER50666", "ER56414", "ER63536", "ER69601")))

names(DrLearnDisord.Spouse) <- mapply(paste, "DrLearnDisord.Spouse", seq(1999, 2017, 2), sep = "_")
```

##Age when doctor told you had learning disorder Spouse

```{r, eval=FALSE}
AgeDrLearnDisord.Spouse <- df %>% select(one_of(c("ER27158", "ER39343", "ER45316", "ER50668", "ER56416", "ER63538", "ER69603")))

names(AgeDrLearnDisord.Spouse) <- mapply(paste, "AgeDrLearnDisord.Spouse", seq(2005, 2017, 2), sep = "_")
```


##Medication if doctor told you had learning disorder Spouse
```{r, eval=FALSE}
MedLearnDisord.Spouse <- df %>% select(one_of(c("ER50670", "ER56418", "ER63540", "ER69605")))

names(MedLearnDisord.Spouse) <- mapply(paste, "MedLearnDisord.Spouse", seq(2011, 2017, 2), sep = "_")
```

##Doctor told you loss of mental ability/memory head
```{r, eval=FALSE}
DrMemLoss.Head <- df %>% select(one_of(c("ER15512", "ER19677", "ER23077", "ER27030", "ER38241", "ER44214", "ER49543", "ER55293", "ER62415", "ER68469")))

names(DrMemLoss.Head) <- mapply(paste, "DrMemLoss.Head", seq(1999, 2017, 2), sep = "_")
```

##Age when doctor told you loss of mental ability/memory head
```{r, eval=FALSE}
DrMemLoss.Head <- df %>% select(one_of(c("ER27031", "ER38242", "ER44215", "ER49545", "ER55295", "ER62417", "ER68471")))

names(DrMemLoss.Head) <- mapply(paste, "DrMemLoss.Head", seq(2005, 2017, 2), sep = "_")
```

##Medication if doctor told you loss of mental ability/memory head
```{r, eval=FALSE}
DrMemLoss.Head <- df %>% select(one_of(c("ER49547", "ER55297", "ER62419", "ER68473")))

names(DrMemLoss.Head) <- mapply(paste, "DrMemLoss.Head", seq(2011, 2017, 2), sep = "_")
```

##Doctor told you loss of mental ability/memory Spouse
```{r, eval=FALSE}
DrMemLoss.Spouse <- df %>% select(one_of(c("ER15620", "ER19785", "ER23204", "ER27153", "ER39338", "ER45311", "ER50661", "ER56409", "ER63531", "ER69596")))

names(DrMemLoss.Spouse) <- mapply(paste, "DrMemLoss.Spouse", seq(1999, 2017, 2), sep = "_")
```

##Age when doctor told you loss of mental ability/memory Spouse
```{r, eval=FALSE}
DrMemLoss.Spouse <- df %>% select(one_of(c("ER27154", "ER39339", "ER45312", "ER50663", "ER56411", "ER63533", "ER69598")))

names(DrMemLoss.Spouse) <- mapply(paste, "DrMemLoss.Spouse", seq(2005, 2017, 2), sep = "_")
```

##Medication if doctor told you loss of mental ability/memory Spouse
```{r, eval=FALSE}
DrMemLoss.Spouse <- df %>% select(one_of(c("ER50665", "ER56413", "ER63535", "ER69600")))

names(DrMemLoss.Spouse) <- mapply(paste, "DrMemLoss.Spouse", seq(2011, 2017, 2), sep = "_")
```


##General health status head
```{r, eval=FALSE}
GenHealth.Head <- df %>% select(one_of(c("V10877", "V11991", "V13417", "V14513", "V15993", "V17390", "V18721", "V20021", "V21321", "V23180", "ER3853", "ER6723", "ER8969", "ER11723", "ER15447", "ER19612", "ER23009", "ER26990", "ER38202", "ER44175", "ER49494", "ER55244", "ER62366", "ER68420")))

names(GenHealth.Head) <- mapply(paste, "GenHealth.Head", c(seq(1984, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##General health status spouse
```{r, eval=FALSE}
GenHealth.Spouse <- df %>% select(one_of(c("V10884", "V12344", "V13452", "V14524", "V15999", "V17396", "V18727", "V20027", "V21328", "V23187", "ER3858", "ER6728", "ER8974", "ER11727", "ER15555", "ER19720", "ER23136", "ER27113", "ER39299", "ER45272", "ER50612", "ER56360", "ER63482", "ER69547")))

names(GenHealth.Spouse) <- mapply(paste, "GenHealth.Spouse", c(seq(1984, 1997, 1), seq(1999, 2017, 2)), sep = "_")
``` 

##Housing status own or rent
```{r, eval=FALSE}
OwnRent <- df %>% select(one_of(c("V103", "V593", "V1264", "V1967", "V2566", "V3108", "V3522", "V3939", "V4450", "V5364", "V5864", "V6479", "V7084", "V7675", "V8364", "V8974", "V10437", "V11618", "V13023", "V14126", "V15140", "V16641", "V18072", "V19372", "V20672", "V22427", "ER2032", "ER5031", "ER7031", "ER10035", "ER13040", "ER17043", "ER21042", "ER25028", "ER36028", "ER42029", "ER47329", "ER53029", "ER60030", "ER66030")))

names(OwnRent) <- mapply(paste, "OwnRent", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
``` 

##Income from interest head

```{r, eval=FALSE}
InterestIncome.Head <- df %>% select(one_of(c("V21861", "ER27936", "ER40926", "ER46834", "ER52242", "ER58043", "ER65221", "ER71298")))

names(InterestIncome.Head) <- mapply(paste, "InterestIncome.Head", c(1993, seq(2005, 2017, 2)), sep = "_")
```

##Income from interest spouse
```{r, eval=FALSE}
InterestIncome.Spouse <- df %>% select(one_of(c("V21925", "ER27949", "ER40939", "ER46847", "ER52255", "ER58056", "ER65249", "ER71326")))

names(InterestIncome.Spouse) <- mapply(paste, "InterestIncome.Spouse", c(1993, seq(2005, 2017, 2)), sep = "_")
```

##Total income from labor head
```{r, eval=FALSE}
TotalLaborIncome.Head <- df %>% select(one_of(c("V74", "V514", "V1196", "V1897", "V2498", "V3051", "V3463", "V3863", "V5031", "V5627", "V6174", "V6767", "V7413", "V8066", "V8690", "V9376", "V11023", "V12372", "V13624", "V14671", "V16145", "V17534", "V18878", "V20178", "V21484", "V23323", "ER4140", "ER6980", "ER9231", "ER12080", "ER16463", "ER20443", "ER24116", "ER27931", "ER40921", "ER46829", "ER52237", "ER58038", "ER65216", "ER71293")))

names(TotalLaborIncome.Head) <- mapply(paste, "TotalLaborIncome.Head", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Wages and salary head
```{r, eval=FALSE}
WageSal.Head <- df %>% select(one_of(c("V251", "V699", "V1191", "V1892", "V2493", "V3046", "V3458", "V3858", "V4373", "V5283", "V5782", "V6391", "V6981", "V7573", "V8265", "V8873", "V10256", "V11397", "V12796", "V13898", "V14913", "V16413", "V17829", "V19129", "V20429", "V21739", "ER4122", "ER6962", "ER9213", "ER12196", "ER16493", "ER20425", "ER24117", "ER27913", "ER40903", "ER46811", "ER52219", "ER58020", "ER65200", "ER71277")))

names(WageSal.Head) <- mapply(paste, "WageSal.Head", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Wife's money income from work to 1993
```{r, eval=FALSE}
TotalLaborIncome1.Spouse <- df %>% select(one_of(c("V75", "V516", "V1198", "V1899", "V2500", "V3053", "V3465", "V3865", "V4379", "V5289", "V5788", "V6398", "V6988", "V7580", "V8273", "V8881", "V10263", "V11404", "V12803", "V13905", "V14920", "V16420", "V17836", "V19136", "V20436", "V23324")))

names(TotalLaborIncome1.Spouse) <- mapply(paste, "TotalLaborIncome1.Spouse", seq(1968, 1993, 1), sep = "_")
```

##Wife's money income from work from 1993
```{r, eval=FALSE}
TotalLaborIncome2.Spouse <- df %>% select(one_of(c("V21807", "ER4144", "ER6984", "ER9235", "ER12082", "ER16465", "ER20447", "ER24135", "ER27943", "ER40933", "ER46841", "ER52249", "ER58050", "ER65244", "ER71321")))

names(TotalLaborIncome2.Spouse) <- mapply(paste, "TotalLaborIncome2.Spouse", c(seq(1993, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```



##Years worked since 18 head
```{r, eval=FALSE}
YearsWorked.Head <- df %>% select(one_of(c("V3620", "V4141", "V4630", "V5604", "V6153", "V6750", "V7383", "V8035", "V8659", "V9345", "V10992", "V11739", "V13605", "V14652", "V16126", "V17523", "V18854", "V20154", "V21460", "V23316", "ER3985", "ER6855", "ER9101", "ER11897", "ER15979", "ER20040", "ER23476", "ER27444", "ER40616", "ER46594", "ER51955", "ER57711", "ER64871", "ER70943")))

names(YearsWorked.Head) <- mapply(paste, "YearsWorked.Head", c(seq(1974, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Years worked since 18 spouse
```{r, eval=FALSE}
YearsWorked.Spouse <- df %>% select(one_of(c("V3610", "V4110", "V4989", "V5574", "V6123", "V6720", "V7353", "V8005", "V8629", "V9315", "V10962", "V12102", "V13531", "V14578", "V16052", "V17449", "V18780", "V20080", "V21386", "V23243", "ER3915", "ER6785", "ER9031", "ER11809", "ER15886", "ER19947", "ER23384", "ER27348", "ER40523", "ER46500", "ER51861", "ER57601", "ER64732", "ER70805")))

names(YearsWorked.Spouse) <- mapply(paste, "YearsWorked.Spouse", c(seq(1974, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```


##Employment status head - ever had a job
```{r, eval=FALSE}
EverJob.Head <- df %>% select(one_of(c("V4552", "V5454", "V5971", "V6556", "V7158", "V7806", "V8467", "V9104", "V10604", "V11751", "V13147", "V14245", "V15318", "V16833", "V18257", "V19557", "V20857", "V22644", "ER2324", "ER5323", "ER7419", "ER10337", "ER13476", "ER17515", "ER21357", "ER25346", "ER36351", "ER42376", "ER47689", "ER53389", "ER60404", "ER66413")))

names(EverJob.Head) <- mapply(paste, "EverJob.Head", c(seq(1976, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```


##Employment status spouse ever had a job
```{r, eval=FALSE}
EverJob.Spouse <- df %>% select(one_of(c("V4936", "V6628", "V7230", "V7919", "V8574", "V9233", "V10804", "V12114", "V13315", "V14409", "V15620", "V17152", "V18559", "V19859", "V21159", "V22997", "ER2818", "ER5817", "ER7913", "ER10819", "ER13988", "ER18086", "ER21607", "ER25604", "ER36609", "ER42628", "ER47946", "ER53652", "ER60667", "ER66688")))

names(EverJob.Spouse) <- mapply(paste, "EverJob.Spouse", c(1976, seq(1979, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Employment status working now 1? Head
```{r, eval=FALSE}
EmployedNow1.Head <- df %>% select(one_of(c("V196", "V639", "V1278", "V1983", "V2581", "V3114", "V3528", "V3967", "V4458", "V5373", "V5872", "V6492", "V7095", "V7706", "V8374", "V9005", "V10453", "V11637", "V13046", "V14146", "V15154", "V16655", "V18093", "V19393", "V20693", "V22448", "ER2068", "ER5067", "ER7163")))

names(EmployedNow1.Head) <- mapply(paste, "EmployedNow1.Head", seq(1968, 1996, 1), sep = "_")
```

##Employment status working now 2  head
```{r, eval=FALSE}
EmployedNow2.Head <- df %>% select(one_of(c("ER2069", "ER5068", "ER7164", "ER10081", "ER13205", "ER17216", "ER21123", "ER25104", "ER36109", "ER42140", "ER47448", "ER53148", "ER60163", "ER66164")))
names(EmployedNow2.Head) <- mapply(paste, "EmployedNow2.Head", c(seq(1994, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Employment status working now spouse
```{r, eval=FALSE}
EmployedNow1.Spouse <- df %>% select(one_of(c("V4841", "V6591", "V7193", "V7879", "V8538", "V9188", "V10671", "V12000", "V13225", "V14321", "V15456", "V16974", "V18395", "V19695", "V20995", "V22801", "ER2562", "ER5561", "ER7657")))

names(EmployedNow1.Spouse) <- mapply(paste, "EmployedNow1.Spouse", c(1976, seq(1979, 1996, 1)), sep = "_")
```

##Employment status working now spouse
```{r, eval=FALSE}
EmployedNow2.Spouse <- df %>% select(one_of(c("ER2563", "ER5562", "ER7658", "ER10563", "ER13717", "ER17786", "ER21373", "ER25362", "ER36367", "ER42392", "ER47705", "ER53411", "ER60426", "ER66439")))
names(EmployedNow2.Spouse) <- mapply(paste, "EmployedNow2.Spouse", c(seq(1994, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Head's annual work hours
```{r, eval=FALSE}
WorkHrs.Head <- df %>% select(one_of(c("V47", "V465", "V1138", "V1839", "V2439", "V3027", "V3423", "V3823", "V4332", "V5232", "V5731", "V6336", "V6934", "V7530", "V8228", "V8830", "V10037", "V11146", "V12545", "V13745", "V14835", "V16335", "V17744", "V19044", "V20344", "V21634", "ER4096", "ER6936", "ER9187", "ER12174", "ER16471", "ER20399", "ER24080", "ER27886", "ER40876", "ER46767", "ER52175", "ER57976", "ER65156", "ER71233")))
names(WorkHrs.Head) <- mapply(paste, "WorkHrs.Head", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Spouse annual work hours
```{r, eval=FALSE}
WorkHrs.Spouse <- df %>% select(one_of(c("V53", "V475", "V1148", "V1849", "V2449", "V3035", "V3431", "V3831", "V4344", "V5244", "V5743", "V6348", "V6946", "V7540", "V8238", "V8840", "V10131", "V11258", "V12657", "V13809", "V14865", "V16365", "V17774", "V19074", "V20374", "V21670", "ER4107", "ER6947", "ER9198", "ER12185", "ER16482", "ER20410", "ER24091", "ER27897", "ER40887", "ER46788", "ER52196", "ER57997", "ER65177", "ER71254")))
names(WorkHrs.Spouse) <- mapply(paste, "WorkHrs.Spouse", c(seq(1968, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

##Industry of head - 1970 code
```{r, eval=FALSE}
Industry1980.Head <- df %>% select(one_of(c("V197_B", "V640_B", "V1279_B", "V1985_A", "V2583_A", "V3116_A", "V3531_A", "V3969_A", "V4460_A", "V5375_A", "V5874_A", "V6498_A", "V7101_A")))
names(Industry1980.Head) <- mapply(paste, "Industry1980.Head", seq(1968, 1980, 1), sep = "_")
```

##Industry of spouse - 1970 code
```{r, eval=FALSE}
Industry1980.Spouse <- df %>% select(one_of(c("V243_B", "V609_B", "V1367_B", "V2075_A", "V2673_A", "V3184_A", "V3602_A", "V4056_A", "V4606_A", "V5508_A", "V6040_A", "V6597_A", "V7199_A")))
names(Industry1980.Spouse) <- mapply(paste, "Industry1980.Spouse", seq(1968, 1980, 1), sep = "_")
```

##Industry of head - 1970 code
```{r, eval=FALSE}
Industry2001.Head <- df %>% select(one_of(c("V7713", "V8381", "V9012", "V10461", "V11652", "V13055", "V14155", "V15163", "V16664", "V18102", "V19402", "V20702", "V22457", "ER4018", "ER6858", "ER9109", "ER12086", "ER13216", "ER17227")))

names(Industry2001.Head) <- mapply(paste, "Industry2001.Head", c(seq(1981, 1997, 1), 1999, 2001), sep = "_")
```

##Industry of spouse - 1970 code
```{r, eval=FALSE}
Industry2001.Spouse <- df %>% select(one_of(c("V7886", "V8545", "V9195", "V10679", "V12015", "V13234", "V14330", "V15465", "V16983", "V18404", "V19704", "V21004", "V22810", "ER4049", "ER6889", "ER9140", "ER12117", "ER13728", "ER17797")))

names(Industry2001.Spouse) <- mapply(paste, "Industry2001.Spouse", c(seq(1981, 1997, 1), 1999, 2001), sep = "_")
```

##Industry of head - 2000 code
```{r, eval=FALSE}
Industry2015.Head <- df %>% select(one_of(c("ER21146", "ER25128", "ER36133", "ER42168", "ER47480", "ER53180", "ER60195", "ER66196")))
names(Industry2015.Head) <- mapply(paste, "Industry2017.Head", seq(2003, 2017, 2), sep = "_")
```

##Industry of spouse -- 2000 code
```{r, eval=FALSE}
Industry2015.Spouse <- df %>% select(one_of(c("ER21396", "ER25386", "ER36391", "ER42420", "ER47737", "ER53443", "ER60458", "ER66471")))
names(Industry2015.Spouse) <- mapply(paste, "Industry2017.Spouse", seq(2003, 2017, 2), sep = "_")
```


##INDUSTRY FULL HEAD

```{r, eval=FALSE}
Industry.Head <- df %>% select(one_of(c("V197_B", "V640_B", "V1279_B", "V1985_A", "V2583_A", "V3116_A", "V3531_A", "V3969_A", "V4460_A", "V5375_A", "V5874_A", "V6498_A", "V7101_A", "V7713", "V8381", "V9012", "V10461", "V11652", "V13055", "V14155", "V15163", "V16664", "V18102", "V19402", "V20702", "V22457", "ER4018", "ER6858", "ER9109", "ER12086", "ER13216", "ER17227", "ER21146", "ER25128", "ER36133", "ER42168", "ER47480", "ER53180", "ER60195", "ER66196")))

names(Industry.Head) <- mapply(paste, "Industry.Head", c(seq(1968, 1980, 1), seq(1981, 1997, 1), 1999, 2001, seq(2003, 2017, 2)), sep = "_")
```


##Head occupation --1970 code
```{r, eval=FALSE}
Occupation1980.Head <- df %>% select(one_of(c("V197_A", "V640_A", "V1279_A", "V1984_A", "V2582_A", "V3115_A", "V3530_A", "V3968_A", "V4459_A", "V5374_A", "V5873_A", "V6497_A", "V7100_A")))

names(Occupation1980.Head) <- mapply(paste, "Occupation1980.Head", seq(1968, 1980, 1), sep = "_")
```

##Spouse occupation -- 1970 code
```{r, eval=FALSE}
Occupation1980.Spouse <- df %>% select(one_of(c("V243_A", "V609_A", "V1367_A", "V2074_A", "V2672_A", "V3183_A", "V3601_A", "V4055_A", "V4605_A", "V5507_A", "V6039_A", "V6596_A", "V7198_A")))
names(Occupation1980.Spouse) <- mapply(paste, "Occupation1980.Spouse", seq(1968, 1980, 1), sep = "_")
```

##Head occupation 1970 code
```{r, eval=FALSE}
Occupation2001.Head <- df %>% select(one_of(c("V3529", "V7712", "V8380", "V9011", "V10460", "V11651", "V13054", "V14154", "V15162", "V16663", "V18101", "V19401", "V20701", "V22456", "ER4017", "ER6857", "ER9108", "ER12085", "ER13215", "ER17226")))

names(Occupation2001.Head) <- mapply(paste, "Occupation2001.Head", c(1974, seq(1981, 1997, 1), 1999, 2001), sep = "_")
```

##Spouse occupation 1970 code
```{r, eval=FALSE}
Occupation2001.Spouse <- df %>% select(one_of(c("V7885", "V8544", "V9194", "V10678", "V12014", "V13233", "V14329", "V15464", "V16982", "V18403", "V19703", "V21003", "V22809", "ER4048", "ER6888", "ER9139", "ER12116", "ER13727", "ER17796")))

names(Occupation2001.Spouse) <- mapply(paste, "Occupation2001.Spouse", c(seq(1981, 1997, 1), 1999, 2001), sep = "_")
```



##Head self-employed?
```{r, eval=FALSE}
SelfEmp2001.Head <- df %>% select(one_of(c("V198", "V641", "V1280", "V1986", "V2584", "V3117", "V3532", "V3970", "V4461", "V5376", "V5875", "V6493", "V7096", "V7707", "V8375", "V9006", "V10456", "V11640", "V13049", "V14149", "V15157", "V16658", "V18096", "V19396", "V20696", "V22451", "ER2074", "ER5073", "ER7169", "ER10086", "ER13210", "ER17221")))

names(SelfEmp2001.Head) <- mapply(paste, "SelEmp2001.Head", c(seq(1968, 1997, 1), 1999, 2001), sep = "_")
```

##Spouse self-employed?
```{r, eval=FALSE}
SelfEmp2001.Spouse <- df %>% select(one_of(c("V4844", "V6592", "V7194", "V7880", "V8539", "V9189", "V10674", "V12003", "V13228", "V14324", "V15459", "V16977", "V18398", "V19698", "V20998", "V22804", "ER2568", "ER5567", "ER7663", "ER10568", "ER13722", "ER17791")))

names(SelfEmp2001.Spouse) <- mapply(paste, "SelfEmp2001.Spouse", c(1974, seq(1979, 1997, 1), 1999, 2001), sep = "_")
```

##Head occupation -- 2000 code
```{r, eval=FALSE}
Occupation2017.Head <- df %>% select(one_of(c("ER21145", "ER25127", "ER36132", "ER42167", "ER47479", "ER53179", "ER60194", "ER66195")))
names(Occupation2017.Head) <- mapply(paste, "Occupation2017.Head", seq(2003, 2017, 2), sep = "_")
```

##Head self employed
```{r, eval=FALSE}
SelfEmp2017.Head <- df %>% select(one_of(c("ER21147", "ER25129", "ER36134", "ER42169", "ER47482", "ER53182", "ER60197", "ER66198")))
names(SelfEmp2017.Head) <- mapply(paste, "SelfEmp2017.Head", seq(2003, 2017, 2), sep = "_")
```

##Spouse occupation --- 2000 code
```{r, eval=FALSE}
Occupation2017.Spouse <- df %>% select(one_of(c("ER21395", "ER25385", "ER36390", "ER42419", "ER47736", "ER53442", "ER60457", "ER66470")))
names(Occupation2017.Spouse) <- mapply(paste, "Occupation2017.Spouse", seq(2003, 2017, 2), sep = "_")
```

##Spouse self employed
```{r, eval=FALSE}
SelfEmp2017.Spouse <- df %>% select(one_of(c("ER21397", "ER25387", "ER36392", "ER42421", "ER47739", "ER53445", "ER60460", "ER66473")))
names(SelfEmp2017.Spouse) <- mapply(paste, "SelfEmp2017.Spouse", seq(2003, 2017, 2), sep = "_")
```


## OCCUPATION FULL HEAD

```{r, eval=FALSE}
Occupation.Head <- df %>% select(one_of(c("V197_A", "V640_A", "V1279_A", "V1984_A", "V2582_A", "V3115_A", "V3530_A", "V3968_A", "V4459_A", "V5374_A", "V5873_A", "V6497_A", "V7100_A", "V3529", "V7712", "V8380", "V9011", "V10460", "V11651", "V13054", "V14154", "V15162", "V16663", "V18101", "V19401", "V20701", "V22456", "ER4017", "ER6857", "ER9108", "ER12085", "ER13215", "ER17226", "ER21145", "ER25127", "ER36132", "ER42167", "ER47479", "ER53179", "ER60194", "ER66195")))

names(Occupation.Head) <- mapply(paste, "Occupation.Head", c(seq(1968, 1980, 1), 1974, seq(1981, 1997, 1), 1999, 2001, seq(2003, 2017, 2)), sep = "_")
```


## Overtime and extra job earnings

### Extra job earnings

Asked of HOH regardless of employment status:
Did you include your earnings from the extra job(s) in the [income] amounts we just talked about? Yes/no

```{r, eval=FALSE}
Extra.Job.income.included <- df %>% select(c(ER3200, ER6200, ER8317, ER11210, ER14476, ER18630, ER21999, ER25980, ER36998, ER42989, ER48311, ER53988, ER61030, ER67082))

names(Extra.Job.income.included) <- mapply(paste("Extra.Job.income.included"), c(1994:1997, seq(1999:2017, 2)), sep = "_")
```


How much did you earn from your extra job(s) (asked in two different questions - this one and the one below – we can check for discrepancies)

```{r, eval=FALSE}
Extra.Job.Income1 <- df %>% select(c(ER3201, ER6201, ER8318, ER11211, ER14477, ER18631, ER22000, ER25981, ER36999, ER42990, ER48312, ER53989, ER61031, ER67083))

names(Extra.Job.Income1) <- mapply(paste, "Extra.Job.Income1", c(seq(1994, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

HOH extra job income

```{r, eval=FALSE}
Extra.Job.Income2 <- df %>% select(c(V21801, ER4138, ER6978, ER9229, ER12212, ER16509, ER20441, ER24131, ER27927, ER40917, ER46825, ER52233, ER58034, ER65212, ER71289))

names(Extra.Job.Income2) <- mapply(paste, "Extra.Job.Income2", c(seq(1993, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```

### Annual overtime hours 

The values for this variable represent the annual overtime hours worked on all jobs if reported separately from regular work hours. All missing data were assigned.
```{r, eval=FALSE}

Annual.OT.Hrs.All.Jobs <- df %>% select(c(V11142, V12541, V13741, V14831, V16331, V17740, V19040, V20340, V21630, ER4094, ER6934, ER9185, ER12172, ER16469, ER20397, ER24079, ER27885, ER40875, ER46765, ER52173, ER57974, ER65154, ER71231))

names(Annual.OT.Hrs.All.Jobs) <- mapply(paste, "Annual.OT.Hrs.All.Jobs", c(seq(1985, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```


### Overtime income of head

```{r, eval=FALSE}
OT.Income <- df %>% select(c(V21743, ER4126, ER6966, ER9217, ER12200, ER16497, ER20429, ER24121, ER27917, ER40907, ER46815, ER52223, ER58024, ER65204, ER71281))

names(OT.Income) <- mapply(paste, "OT.Income", c(seq(1993, 1997, 1), seq(1999, 2017, 2)), sep = "_")
```


## Extra job questions - asked about reported hours and amount of overtime for up to 4 jobs, all reported individually
E.g., job 1 (main job):

### How many hours did that overtime amount to in (that period during) 2002?
```{r, eval=FALSE}
OT.Hrs.Main.Job <- df %>% select(c(ER21429, ER25426, ER36431, ER42458, ER47776, ER53482, ER60497, ER66512))

names(OT.Hrs.Main.Job) <- mapply(paste, "OT.Hrs.Main.Job", seq(2003, 2017, 2), sep = "_")
```


### Did you work any overtime (that wasn’t included in average hours/week already reported)?  Yes/no

Asked of HOH who ARE CURRENTLY EMPLOYED:
```{r, eval=FALSE}

Any.OT.Not.Rep <- df %>% select(c(V9036, V10563, V11707, V13107, V14205, V15259, V16760, V18198, V19498, V20798, V22579, ER2226, ER5225, ER7321, ER10233, ER13364, ER17395))

names(Any.OT.Not.Rep) <- mapply(paste, "Any.OT.Not.Rep", c(seq(1983, 1997, 1), 1999, 2001), sep = "_")
```


### Did you have any extra jobs or other ways of making money in addition to your main job in 1982? Yes/no

Asked of HOH who ARE CURRENTLY EMPLOYED:
```{r, eval=FALSE}
Extra.Job <- df %>% select(c(V9037, V10564, V11708, V13108, V14206, V15260, V16761, V18199, V19499, V20799, V22580, ER2228, ER5227, ER7323, ER10235, ER13366, ER17398))

names(Extra.Job) <- mapply(paste, "Extra.Job", c(seq(1983, 1997, 1), 1999, 2001), sep = "_")
```


### Total number of extra jobs held by Head during 1982.  (1-8; 9 is NA)

```{r, eval=FALSE}

Total.Jobs <- df %>% select(c(V9039, V10565, V11709, V13109, V14207, V15261, V16762, V18200, V19500, V20800, V22581))


names(Total.Jobs) <- mapply(paste, "Total.Jobs", seq(1983, 1993, 1), sep = "_")
```


### Actual number of hours per week Head worked on his/her extra job. If Head had more than one extra job, the value here represents a weighted average of hours spent on all extra jobs.
```{r, eval=FALSE}
Hrs.Extra.Jobs <- df %>% select(c(V9042, V10569, V11713, V13113, V14211, V15267, V16768, V18206, V19506, V20806, V22589, ER2233, ER5232, ER7328, ER10240, ER13373, ER17406))

names(Hrs.Extra.Jobs) <- mapply(paste, "Hrs.Extra.Jobs", c(seq(1983, 1997, 1), 1999, 2001), sep = "_")
```


## On the average, how many hours a week did you work when you worked in 1982?

Asked of HOH who are CURRENTLY UNEMPLOYED:
```{r, eval=FALSE}

Hrs.When.Empl <- df %>% select(c(V9120, V10630, V11803, V13199, V14295, V15405, V16920, V18344, V19644, V20944, V22743, ER2470, ER5469, ER7565, ER10471, ER13616, ER17675))

names(Hrs.When.Empl) <- mapply(paste, "Hrs.When.Empl", c(seq(1983, 1997, 1), 1999, 2001), sep = "_")
```




### Number of extra jobs (1-8, 9 is NA)

```{r, eval=FALSE}
Num.Extra.Jobs.Unempl <- df %>% select(c(V9123, V10632, V11805, V13201, V14297, V15408, V16923, V18347, V19647, V20947, V22747))

names(Num.Extra.Jobs.Unempl) <- mapply(paste, "Num.Extra.Jobs.Unempl", seq(1983, 1993, 1), sep = "_")
```


### On the average, how many hours a week did you work on your extra job(s)?

```{r, eval=FALSE}
Hrs.Extra.Jobs.Unempl <- df %>% select(c(V9126, V10636, V11809, V13205, V14301, V15414, V16929, V18353, V19653, V20953, V22755, ER2478, ER5477, ER7573, ER10479, ER13626, ER17688))

names(Hrs.Extra.Jobs.Unempl) <- mapply(paste, "Hrs.Extra.Jobs.Unempl", c(seq(1983, 1997, 1), 1999, 2001), sep = "_")
```

## Hourly/salary

```{r, eval=FALSE}
Hrly.Slry <- df %>% select(V4002, V4509, V5420, V5907, V6518, V7121, V7714, V8382, V9013, V10462, V11653, V13056, V14156, V15164, V16665, V18103, V19403, V20703, V22463, ER2081, ER5080, ER7176, ER10091, ER13217, ER17228, ER21152, ER25141, ER36146, ER42181, ER47494, ER53194, ER60209, ER66210)

names(Hrly.Slry) <- mapply(paste, "Hrly.Slry", c(1975:1997, seq(1999, 2017, 2)), sep = "_")
```


##Head belong to union
```{r, eval=FALSE}

UnionMember1981.Head <- df %>% select(one_of(c("V766", "V1434", "V2145", "V2787", "V3636", "V4087", "V4624", "V5559", "V6101", "V6707", "V7340", "V7971")))

names(UnionMember1981.Head) <- mapply(paste, "UnionMember1981.Head", c(seq(1969, 1972, 1), seq(1974, 1981, 1)), sep = "_")
```

##Spouse belong to union
```{r, eval=FALSE}
UnionMember1981.Spouse <- df %>% select(one_of(c("V4929", "V6709", "V7342", "V7973")))

names(UnionMember1981.Spouse) <- mapply(paste, "UnionMember1981.Spouse", c(1976, 1979:1981), sep = "_")
```

##Head covered by union
```{r, eval=FALSE}
UnionCovered.Head <- df %>% select(one_of(c("V4478", "V5382", "V5877", "V6495", "V7098", "V7709", "V8377", "V9008", "V10458", "V11649", "V13052", "V14152", "V15160", "V16661", "V18099", "V19399", "V20699", "V22454", "ER2079", "ER5078", "ER7174", "ER10089", "ER13213", "ER17224", "ER21150", "ER25138", "ER36143", "ER42178", "ER47491", "ER53191", "ER60206", "ER66207")))

names(UnionCovered.Head) <- mapply(paste, "UnionCovered.Head", c(1976:1997, seq(1999, 2017, 2)), sep = "_")
```

##Spouse covered by union
```{r, eval=FALSE}
UnionCovered.Spouse <- df %>% select(one_of(c("V4861", "V6594", "V7196", "V7882", "V8541", "V9191", "V10676", "V12012", "V13231", "V14327", "V15462", "V16980", "V18401", "V19701", "V21001", "V22807", "ER2573", "ER5572", "ER7668", "ER10571", "ER13725", "ER17794", "ER21400", "ER25396", "ER36401", "ER42430", "ER47748", "ER53454", "ER60469", "ER66482")))

names(UnionCovered.Spouse) <- mapply(paste, "UnionCovered.Spouse", c(1976, 1979:1997, seq(1999, 2017, 2)), sep = "_")
```

##AGE
```{r, eval=FALSE}
Age.Head <- df %>% select(one_of(c("ER30004", "ER30023", "ER30046", "ER30070", "ER30094", "ER30120", "ER30141", "ER30163", "ER30191", "ER30220", "ER30249", "ER30286", "ER30316", "ER30346", "ER30376", "ER30402", "ER30432", "ER30466", "ER30501", "ER30538", "ER30573", "ER30609", "ER30645", "ER30692", "ER30736", "ER30809", "ER33104", "ER33204", "ER33304", "ER33404", "ER33504", "ER33604", "ER33704", "ER33804", "ER33904", "ER34004", "ER34104", "ER34204", "ER34305", "ER66017")))

names(Age.Head) <- mapply(paste, "Age.Head", c(1968:1997, seq(1999, 2017, 2)), sep = "_")
```

##SEX
```{r, eval=FALSE}
df$Sex <- df$ER32000
```

##Grades completed
```{r, eval=FALSE}
GradesCompl <- df %>% select(one_of(c("ER30010", "ER30052", "ER30076", "ER30100", "ER30126", "ER30147", "ER30169", "ER30197", "ER30226", "ER30255", "ER30296", "ER30326", "ER30356", "ER30384", "ER30413", "ER30443", "ER30478", "ER30513", "ER30549", "ER30584", "ER30620", "ER30657", "ER30703", "ER30748", "ER30820", "ER33115", "ER33215", "ER33315", "ER33415", "ER33516", "ER33616", "ER33716", "ER33817", "ER33917", "ER34020", "ER34119", "ER34230", "ER34349", "ER34548")))

names(GradesCompl) <- mapply(paste, "GradesCompl", c(1968, 1970:1997, seq(1999, 2017, 2)), sep = "_")
```

##Health insurance covered now
```{r, eval=FALSE}
HealthInsNow <- df %>% select(one_of(c("ER34128", "ER34235", "ER34385", "ER34594")))
names(HealthInsNow) <- mapply(paste, "HealthInsNow", c(2011, 2013, 2015, 2017), sep = "_")
```

##Sample weight longitudinal core and immigrant
```{r, eval=FALSE}
SampWeight2015 <- df %>% select(one_of(c("ER33430", "ER33546", "ER33637", "ER33740", "ER33848", "ER33950", "ER34045", "ER34154", "ER34268", "ER34413", "ER34650")))

names(SampWeight2015) <- mapply(paste, "SampWeight2015", seq(1997, 2017, 2), sep = "_")
```

##Sample weight longitudinal core
```{r, eval=FALSE}
SampWeight1996 <- df %>% select(one_of(c("ER30019", "ER30042", "ER30066", "ER30090", "ER30116", "ER30137", "ER30159", "ER30187", "ER30216", "ER30245", "ER30282", "ER30312", "ER30342", "ER30372", "ER30398", "ER30428", "ER30462", "ER30497", "ER30534", "ER30569", "ER30605", "ER30641", "ER30686", "ER30730", "ER30803")))

names(SampWeight1996) <- mapply(paste, "SampWeight1996", c(1968:1992), sep = "_")
```

##Sample weight longitudinal core 1993 revised
```{r, eval=FALSE}
SampWeight9396Rev <- df %>% select(one_of(c("ER30864", "ER33119", "ER33275", "ER33318")))
names(SampWeight9396Rev) <- mapply(paste, "SampWeight9396Rev", c(1993:1996), sep = "_")
```

##ID INTERVIEW NUMBER 
```{r, eval = FALSE}
InterviewNum <- df %>% select(one_of(c("ER30001", "ER30020", "ER30043", "ER30067", "ER30091", "ER30117", "ER30138", "ER30160", "ER30188", "ER30217", "ER30246", "ER30283", "ER30313", "ER30343", "ER30373", "ER30399", "ER30429", "ER30463", "ER30498", "ER30535", "ER30570", "ER30606", "ER30642", "ER30689", "ER30733", "ER30806", "ER33101", "ER33201", "ER33301", "ER33401", "ER33501", "ER33601", "ER33701", "ER33801", "ER33901", "ER34001", "ER34101", "ER34201", "ER34301", "ER34501")))

names(InterviewNum) <- mapply(paste, "InterviewNum", c(1968:1997, seq(1999, 2017, 2)), sep = "_")
```

##PERSON NUMBER
```{r, eval=FALSE}
df$PersonNum <- df$ER30002
```


##RELATION TO HEAD
```{r, eval=FALSE}
RelationToHead <- df %>% select(one_of(c("ER30003", "ER30022", "ER30045", "ER30069", "ER30093", "ER30119", "ER30140", "ER30162", "ER30190", "ER30219", "ER30248", "ER30285", "ER30315", "ER30345", "ER30375", "ER30401", "ER30431", "ER30465", "ER30500", "ER30537", "ER30572", "ER30608", "ER30644", "ER30691", "ER30735", "ER30808", "ER33103", "ER33203", "ER33303", "ER33403", "ER33503", "ER33603", "ER33703", "ER33803", "ER33903", "ER34003", "ER34103", "ER34203", "ER34303", "ER34503")))

names(RelationToHead) <- mapply(paste, "RelationToHead", c(1968:1997, seq(1999, 2017, 2)), sep = "_")
```


##Sequence number
```{r, eval=FALSE}
SeqNum <- df %>% select(one_of(c("ER30021", "ER30044", "ER30068", "ER30092", "ER30118", "ER30139", "ER30161", "ER30189", "ER30218", "ER30247", "ER30284", "ER30314", "ER30344", "ER30374", "ER30400", "ER30430", "ER30464", "ER30499", "ER30536", "ER30571", "ER30607", "ER30643", "ER30690", "ER30734", "ER30807", "ER33102", "ER33202", "ER33302", "ER33402", "ER33502", "ER33602", "ER33702", "ER33802", "ER33902", "ER34002", "ER34102", "ER34202", "ER34302", "ER34502")))

names(SeqNum) <- mapply(paste, "SeqNum", c(1969:1997, seq(1999, 2017, 2)), sep = "_")
```


##Sampling error cluster
```{r, eval=FALSE}
df$SampErrClust <- df$ER31997
```

##Sampling error stratum
```{r, eval=FALSE}
df$SampErrStrat <- df$ER31996
```

## Individual weight

```{r, eval=FALSE}
Individ.Weight <- df %>% select(ER30019, ER30042, ER30066, ER30090, ER30116, ER30137, ER30159, ER30187, ER30216, ER30245, ER30282, ER30312, ER30342, ER30372, ER30398, ER30428, ER30462, ER30497, ER30534, ER30569, ER30605, ER30641, ER30688, ER30732, ER30805, ER30866, ER33121, ER33277, ER33318, ER33430, ER33546, ER33637, ER33740, ER33848, ER33950, ER34045, ER34154, ER34268, ER34413, ER34650)

names(Individ.Weight) <- mapply(paste, "Individ.Weight", c(1968:1996, seq(1997, 2017, 2)), sep = "_")
```



#Combine everything

```{r, eval=FALSE}

colgroups <- ls()

CleanData_Wide <- cbind(df[, c("ID", "SampErrClust", "SampErrStrat", "Sex")], bind_cols(mget(colgroups[!(colgroups %in% c("df", "RAW"))])))

which(names(CleanData_Wide) == "V1")

CleanData_Wide[, c(680:690)]

save(CleanData_Wide, file = "/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/CleanData_Wide_5-1-19.Rdata")

rm(list = ls())
```

#Wide to long
```{r, eval=FALSE}

load("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/CleanData_Wide_5-1-19.Rdata")

library(beepr)

CleanData <- CleanData_Wide %>%
  gather(key = var, value = val, -ID, -SampErrClust, -SampErrStrat, -Sex) %>%
  separate(var, c("Variable", "Year"), "_")


CleanData <- CleanData %>% spread(Variable, val)

save(CleanData, file = "/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/CleanData_5-1-19.Rdata")
beep()
```


# Before restricting, get spouse's income info to make composite variable

```{r, eval=TRUE}

library(tidyverse)

load("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/CleanData_5-1-19.Rdata")

``` 

#Restrict data to heads of household (since only they are asked K6)

```{r}
CleanData$SpouseIncome1 <- CleanData$TotalLaborIncome1.Spouse
CleanData$SpouseIncome2 <- CleanData$TotalLaborIncome2.Spouse

df <- CleanData %>%
  dplyr::select(-contains(".Spouse")) %>%
  filter(RelationToHead == 10)
```

#For every respondent from 2003-2015 (when K6 asked), go back as far as their first year of participation - 1983
```{r}
UniqueIDs <- df %>% filter(Year %in% c("2003", "2005", "2007", "2009", "2011", "2013", "2015", "2017"))
UniqueIDs <- unique(UniqueIDs$ID)
df <- df %>% filter(ID %in% UniqueIDs)
df$ID <- as.factor(df$ID)

# df %>% group_by(Year) %>% summarize(max(Age.Head, na.rm=TRUE))
```

     

#Check variable value options for Qs asked every year
```{r}
# Recode Age

df$Year <- as.numeric(df$Year)

df <- df %>% mutate(Age = ifelse(Year %in% c(1983:1993) & Age.Head > 98, NA, ifelse(Year %in% c(1994:1996) &
  Age.Head %in% c(0, 98, 99), NA, ifelse(Year %in% c(1997:2017) & Age.Head > 120, NA,
  Age.Head
))))

df <- select(df, -Age.Head)
```                    
                    


# Recode industries and occupations into standard groups, 1970s codes and 2000s codes, collapse into one variable

## Create Categortical Industry Variable

```{r}

df <- df %>% mutate(Industry_Cat = case_when(
  (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(407:479)) | (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(57:69)) | ( .$Year %in% c(2003:2017) & .$Industry.Head %in% c(607:639)) ~ "Transport/Comm/PubUtil",
  (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(507:698)) | (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(407:459)) | (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(467:579)) ~ "Whole/Retail Trade",
  (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(707:718)) | (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(687:699)) | (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(707:719)) ~ "Finance/Insur/RealEstate",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(727:759) ~ "BusinessRepairServices",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(769:798) ~ "PersonalServices",
  (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(807:809)) | ( .$Year %in% c(2003:2017) & .$Industry.Head %in% c(856:859)) ~ "Entertain/Rec Services",
  .$Year %in% c(1983:2001) & .$Industry.Head %in% c(999, 0, 998, NA) ~ "Unknown",
  (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(17:29)) | (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(17:28)) ~ "Agra/Forest/Fish",
  (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(37:49)) | (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(47:57)) ~ "Mining",
  (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(77)) | (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(67:77)) ~ "Construction",
  (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(107:399)) | (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(107:398)) ~ "Manufacturing",
  .$Year %in% c(2003:2017) & .$Industry.Head %in% c(647:679) ~ "Information",
  (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(727:749)) | (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(828:897)) ~ "Pro/Sci/Tech Services",
  .$Year %in% c(2003:2017) & .$Industry.Head %in% c(757:779) ~ "Mgmt/Admin/Waste Services",
  .$Year %in% c(2003:2017) & .$Industry.Head %in% c(786:789) ~ "Educ Services",
  .$Year %in% c(2003:2017) & .$Industry.Head %in% c(797:847) ~ "Healthcare/Social Services",
  .$Year %in% c(2003:2017) & .$Industry.Head %in% c(866:869) ~ "Accom/Food Services",
  .$Year %in% c(2003:2017) & .$Industry.Head %in% c(877:929) ~ "Other Services",
  (.$Year %in% c(2003:2017) & .$Industry.Head %in% c(937:987)) | (.$Year %in% c(1983:2001) & .$Industry.Head %in% c(907:937)) ~ "Public Admin/Military",
  .$Year %in% c(2003:2017) & .$Industry.Head %in% c(848, 999, 0, NA) ~ "Unknown"),
  Industry_Cat = replace_na(Industry_Cat, "Unknown"))

df <- df %>% select(-c(Industry.Head, Industry1980.Head, Industry2001.Head, Industry2017.Head))
```

## Create Change in Industry Variable

```{r}
df <- df %>%
  group_by(ID) %>%
  mutate(Industry_Change_83_01 = if_else(Year <= 2003 & Industry_Cat != lag(Industry_Cat), 1, 0)) %>%
  group_by(ID) %>%
  mutate(N_Change_Industry_Base = cumsum(replace_na(Industry_Change_83_01, 0)))
  

df <- select(df, -Industry_Change_83_01)

```

## Create modal Industry prior to 2003 variable

```{r}
Modal_Industry_Base <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(Industry_Cat) %>%
  dplyr::slice(which.max(n)) %>%
  transmute(Industry_Base = Industry_Cat)

df <- left_join(df, Modal_Industry_Base, by = "ID")

df <- df %>% mutate(Industry_Base = replace_na(Industry_Base, "None"))

df <- ungroup(df)
rm(Modal_Industry_Base)

```


## Create Categortical Occupation Variable

```{r}

df <- df %>% mutate(Occupation_Cat = case_when(
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(1:95) ~ "Pro/Tech/Kindred",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(401:600) ~ "Crafts/Kindred",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(601:695) ~ "Operatives",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(740:785) ~ "Laborers",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(821:824) ~ "Farm Laborers/Foremen",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(901:965) ~ "Service Workers",
  .$Year %in% c(1983:2001) & .$Occupation.Head %in% c(980:984) ~ "PrivateHousehold Workers",
  (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(1:42)) | (.$Year %in% c(1983:2001) & .$Occupation.Head %in% c(201:245)) ~ "Management",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(50:73) ~ "Business Ops Specialists",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(80:95) ~ "Financial Specialists",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(100:124) ~ "Computer/Mathematical",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(130:156) ~ "Architect/Engineering",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(160:196) ~ "Life/Phys/Soc Sciences",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(200:206) ~ "Community/Social Services",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(210:215) ~ "Legal",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(220:255) ~ "Educ/Training/Library",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(260:296) ~ "Arts/Media/Sports/Entertainment",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(300:354) ~ "Healthcare",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(370:395) ~ "Protective Services",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(400:416) ~ "Food Prep/Serving",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(420:425) ~ "Building/Grounds/Maintenance",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(430:465) ~ "Personal Care",
  (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(470:496)) | (.$Year %in% c(1983:2001) & .$Occupation.Head %in% c(260:285)) ~ "Sales",
  (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(500:593)) | (.$Year %in% c(1983:2001) & .$Occupation.Head %in% c(301:395)) ~ "Office/Admin Support",
  (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(600:613)) | (.$Year %in% c(1983:2001) & .$Occupation.Head %in% c(801:802)) ~ "Farm/Fish/Forest",
  (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(680:694)) | (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(620:676)) ~ "Construction/Extraction",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(700:762) ~ "Install/Maint/Repair",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(770:896) ~ "Production",
  (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(900:975)) | (.$Year %in% c(1983:2001) & .$Occupation.Head %in% c(701:715)) ~ "Transportation/Material Moving",
  .$Year %in% c(2003:2017) & .$Occupation.Head %in% c(980:983) ~ "Military",
  (.$Year %in% c(2003:2017) & .$Occupation.Head %in% c(615, 999, 0, 998, NA)) | (.$Year %in% c(1983:2001) & .$Occupation.Head %in% c(0, 999, 998, 810, NA)) ~ "Unknown"
))

df <- df %>% mutate(Occupation_Cat = replace_na(Occupation_Cat, "Unknown"))

df <- df %>% select(-c(Occupation.Head, Occupation1980.Head, Occupation2001.Head, Occupation2017.Head))
```



## Create Change in Occupation Variable

```{r}
df <- df %>%
  group_by(ID) %>%
  mutate(Occupation_Change_83_01 = if_else(Year <= 2003 & Occupation_Cat != lag(Occupation_Cat), 1, 0)) %>%
  group_by(ID) %>%
  mutate(N_Change_Occupation_Base = cumsum(replace_na(Occupation_Change_83_01, 0)))

df <- df %>% select(-Occupation_Change_83_01)
```

## Create modal Occupation prior to 2003 variable

```{r}

Modal_Occupation_Base <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(Occupation_Cat) %>%
  dplyr::slice(which.max(n)) %>%
  transmute(Occupation_Base = Occupation_Cat)

df <- left_join(df, Modal_Occupation_Base, by = "ID")

df <- df %>% mutate(Occupation_Base = replace_na(Occupation_Base, "None"))

df <- ungroup(df)
rm(Modal_Occupation_Base)
```

# Recode Race Variable

```{r}
df <- df %>% mutate(Race_cat = case_when(
  Race.Head == 1 ~ "White",
  Race.Head %in% c(2:5) ~ "POC",
  Race.Head == 7 ~ "Other",
  Race.Head %in% c(0, 9, NA) ~ "Unknown"
))

df <- select(df, -Race.Head)

df$Race_cat <- factor(df$Race_cat, levels = c("White", "POC", "Other", "Unknown"))
```


# CREATE BASELINE VARS, CLEAN TIME VARYING AND FIXED VARS


## Psych condition

```{r}

df <- df %>% mutate(ConditionPsych_TV = case_when(
  ConditionPsych.Head == 1 ~ "Depression",
  ConditionPsych.Head == 2 ~ "Bipolar",
  ConditionPsych.Head == 3 ~ "Schizophrenia",
  ConditionPsych.Head == 4 ~ "Anxiety",
  ConditionPsych.Head == 5 ~ "Phobias",
  ConditionPsych.Head == 6 ~ "Alcohol use/abuse",
  ConditionPsych.Head == 7 ~ "Drug use/abuse",
  ConditionPsych.Head == 8 ~ "OCD",
  ConditionPsych.Head == 97 ~ "Other",
  ConditionPsych.Head %in% c(98, 99, NA) ~ "Unknown",
  ConditionPsych.Head == 0 ~ "None"
))

# get rid of some other vars too
df <- df %>% select(-ConditionPsych.Head, -AgeDrEmotProb.Head, -AgeDrLearnDisord.Head)
```




## Depression, Drug, Emotional Prob, Poor Health before 17

The "before 17" variables seem to have a complicated skip pattern, where you only get the module once and so future waves you might be missing. Going to treat these as "if you ever answered, that's your answer"

```{r, eval = TRUE}

df <- df %>% mutate(
  Depressed17 = case_when(
    Depressed17.Head == 5 ~ "No",
    Depressed17.Head == 1 ~ "Yes",
    Depressed17.Head %in% c(0, 8, 9, NA) ~ "Unknown"
  ),
  DrugProb17 = case_when(
    DrugProb17.Head == 5 ~ "No",
    DrugProb17.Head == 1 ~ "Yes",
    DrugProb17.Head %in% c(0, 8, 9, NA) ~ "Unknown"
  ),
  EmotProb = case_when(
    EmotProb.Head == 5 ~ "No",
    EmotProb.Head == 1 ~ "Yes",
    EmotProb.Head %in% c(0, 8, 9, NA) ~ "Unknown"
  ),
  KidHealth = case_when(
    KidHealth.Head %in% c(1:3) ~ "No",
    KidHealth.Head %in% c(4, 5) ~ "Yes",
    KidHealth.Head %in% c(0, 8, 9, NA) ~ "Unknown"
  )
)

df <- df %>%
  group_by(ID) %>%
  mutate(
    Depressed.Base = if_else(any(Depressed17 == "Yes"), "Yes", if_else(any(Depressed17 == "No"), "No", "Unknown")),
    DrugProb.Base = if_else(any(DrugProb17 == "Yes"), "Yes", if_else(any(DrugProb17 == "No"), "No", "Unknown")),
    EmotProb.Base = if_else(any(EmotProb == "Yes"), "Yes", if_else(any(EmotProb == "No"), "No", "Unknown")),
    KidHealth.Base = if_else(any(KidHealth == "Yes"), "Yes", if_else(any(KidHealth == "No"), "No", "Unknown"))
  ) %>%
  ungroup(df)

df <- df %>% select(-c(Depressed17.Head, DrugProb17.Head, EmotProb.Head, KidHealth.Head, Depressed17, DrugProb17, EmotProb, KidHealth))
```


## Alcohol use (also fix drinks per day variable)
```{r}

df <- df %>%
  mutate(
    AlcFreq_TV = as.factor(case_when(
      AlcFreq.Head == 0 ~ "Never",
      AlcFreq.Head == 1 ~ "<1perMnth",
      AlcFreq.Head == 2 ~ "1perMnth",
      AlcFreq.Head == 3 ~ ">1perMnth",
      AlcFreq.Head == 4 ~ "1perWeek",
      AlcFreq.Head == 5 ~ ">1perWeek",
      AlcFreq.Head == 6 ~ "EveryDay",
      AlcFreq.Head %in% c(8, 9, NA) ~ "Unknown"
    )),
    DrinksPerDay_TV = as.factor(case_when(
      Year == 2003 & DrinksPerDay.Head == 0 ~ "None",
      Year == 2003 & DrinksPerDay.Head == 1 ~ "<1perDay",
      Year == 2003 & DrinksPerDay.Head == 2 ~ "1:2perDay",
      Year == 2003 & DrinksPerDay.Head == 3 ~ "3:4perDay",
      Year == 2003 & DrinksPerDay.Head == 4 ~ ">=5perDay",
      Year == 2003 & DrinksPerDay.Head %in% c(8, 9, NA) ~ "Unknown",
      Year %in% c(2005:2017) & DrinksPerDay.Head == 0 ~ "None",
      Year %in% c(2005:2017) & DrinksPerDay.Head %in% c(1:2) ~ "1:2perDay",
      Year %in% c(2005:2017) & DrinksPerDay.Head %in% c(3:4) ~ "3:4perDay",
      Year %in% c(2005:2017) & DrinksPerDay.Head >= 5 ~ ">=5perDay",
      Year %in% c(2005:2017) & DrinksPerDay.Head %in% c(98:99, NA) ~ "Unknown"
    ))
  )

df <- df %>% select(-c(AlcFreq.Head, DrinksPerDay.Head))
```



## Did a doctor ever tell you that you have...
```{r}

df <- df %>% mutate(
  DrEmotProb = case_when(
    DrEmotProb.Head == 1 ~ "Yes",
    DrEmotProb.Head == 5 ~ "No",
    DrEmotProb.Head %in% c(8, 9, 0, NA) ~ "Unknown"
  ),
  DrLearnDisord = case_when(
    DrLearnDisord.Head == 1 ~ "Yes",
    DrLearnDisord.Head == 5 ~ "No",
    DrLearnDisord.Head %in% c(8, 9, 0, NA) ~ "Unknown"
  ),
  DrMemLoss = case_when(
    DrMemLoss.Head == 1 ~ "Yes",
    DrMemLoss.Head == 5 ~ "No",
    DrMemLoss.Head %in% c(8, 9, 0, NA) ~ "Unknown"
  )
)



df <- df %>%
  group_by(ID) %>%
  mutate(
    DrEmotProb.Base = if_else(any(DrEmotProb == "Yes"), "Yes", if_else(any(DrEmotProb == "No"), "No", "Unknown")),
    DrLearnDisord.Base = if_else(any(DrLearnDisord == "Yes"), "Yes", if_else(any(DrLearnDisord == "No"), "No", "Unknown")),
    DrMemLoss.Base = if_else(any(DrMemLoss == "Yes"), "Yes", if_else(any(DrMemLoss == "No"), "No", "Unknown"))
  ) %>%
  ungroup(df)

df <- df %>% select(-c(DrEmotProb.Head, DrLearnDisord.Head, DrMemLoss.Head, DrEmotProb, DrLearnDisord, DrMemLoss))
```

##Employment Status

```{r}

df <- df %>%
  mutate(EmploymentStatus_TV = case_when(
    EmployedNow2.Head == 1 ~ "Working",
    EmployedNow2.Head == 2 ~ "TempNotWork",
    EmployedNow2.Head == 3 ~ "Looking/Unempl",
    EmployedNow2.Head == 4 ~ "Retired",
    EmployedNow2.Head == 5 ~ "Disabled",
    EmployedNow2.Head == 6 ~ "Keeping house",
    EmployedNow2.Head == 7 ~ "Student",
    EmployedNow2.Head == 8 ~ "Other",
    EmployedNow2.Head %in% c(0, 9, 98, 99, NA) ~ "Unknown"
  ))

df <- df %>% mutate(EmploymentStatus_TV = replace_na(EmploymentStatus_TV, "Unknown"))

df <- df %>% select(-EmployedNow2.Head)
```

## Change in Employement Status prior to 2003

```{r}
df <- df %>%
  group_by(ID) %>%
  mutate(EmployStatusChange_to_01 = if_else(Year <= 2003 & EmploymentStatus_TV != lag(EmploymentStatus_TV), 1, 0)) %>%
  group_by(ID) %>%
  mutate(N_Change_Employ_Base = cumsum(replace_na(EmployStatusChange_to_01, 0))) %>%
  ungroup(df)


df <- select(df, -EmployStatusChange_to_01)
```

## Create modal Base employment status

```{r}

Modal_EmployStatus_Base <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(EmploymentStatus_TV) %>%
  dplyr::slice(which.max(n)) %>%
  transmute(EmploymentStatus.Base = EmploymentStatus_TV)

df <- left_join(df, Modal_EmployStatus_Base, by = "ID")

df <- df %>% mutate(EmploymentStatus.Base = replace_na(EmploymentStatus.Base, "None"))

df <- ungroup(df)

rm(Modal_EmployStatus_Base)
```


## Ever smoked


```{r}

df <- df %>%
  mutate(EverSmoked_TV = case_when(
         EverSmoked.Head == 1 ~ "Yes",
         EverSmoked.Head == 5 ~ "No", 
         EverSmoked.Head %in% c(8, 9, NA) ~ "Unknown",
         EverSmoked.Head == 0 ~ "Yes Currently"))

df <- select(df, -EverSmoked.Head)
```

## Family size          

```{r}
df$FamilySize <- ifelse(df$FamilySize < 99, df$FamilySize, NA)

Mean_Fam_Size <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(Mean_Fam_Size_Base = mean(FamilySize, na.rm = TRUE)) %>%
  ungroup(df)

df <- left_join(df, Mean_Fam_Size, by = "ID")

df <- df %>% rename(FamilySize_TV = FamilySize)

rm(Mean_Fam_Size)
```

## General Health
```{r}

df <- df %>%
  mutate(GenHealth_TV = case_when(
    GenHealth.Head %in% c(1:3) ~ "No",
    GenHealth.Head %in% c(4, 5) ~ "Yes",
    GenHealth.Head %in% c(0, 8, 9, NA) ~ "Unknown"
  ))

df <- df %>%
  group_by(ID) %>%
  mutate(GenHealth.Base = if_else(any(GenHealth_TV == "Yes"), "Yes", if_else(any(GenHealth_TV == "No"), "No", "Unknown"))) %>%
  ungroup(df)

df <- select(df, -GenHealth.Head)
```

## Grades Completed

```{r}
# lt high school, 12=high school, 13-15 = some college, 16=college, 17=more than college

df <- df %>% mutate(GradesCompl_TV = case_when(
  GradesCompl %in% c(1:11) ~ "<HS",
  GradesCompl == 12 ~ "HS",
  GradesCompl %in% c(13:15) ~ "Some College",
  GradesCompl == 16 ~ "College",
  GradesCompl == 17 ~ ">College",
  GradesCompl %in% c(0, 99, NA) ~ "Unknown"
))

df <- df %>% select(-GradesCompl)

```

##InterestIncome, and Base

```{r}

df$InterestIncome_TV <- ifelse(is.na(df$InterestIncome.Head), 0, df$InterestIncome.Head)

## Base
df$InterestIncome.2003 <- ifelse(df$Year <= 2003, df$InterestIncome.Head, NA)

df.interest <- df %>%
  group_by(ID) %>%
  dplyr::summarize(InterestIncome.Base = mean(InterestIncome.2003, na.rm = TRUE))
# merge back
df <- left_join(df, df.interest, by = "ID")

df <- df %>% mutate(InterestIncome.Base = replace_na(InterestIncome.Base, 0))

df <- select(df, -c(InterestIncome.Head, InterestIncome.2003))

rm(df.interest)
```


## Own or rent, and modale Base own/rent

```{r}

df <- df %>% mutate(OwnRent_TV = case_when(
  OwnRent == 1 ~ "Owns",
  OwnRent == 5 ~ "Rents",
  OwnRent == 8 ~ "Neither",
  OwnRent %in% c(0, 9, NA) ~ "Unknown"
))

Modal_OwnRent_Base <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(OwnRent_TV) %>%
  dplyr::slice(which.max(n)) %>%
  transmute(OwnRent.Base = OwnRent_TV)

df <- left_join(df, Modal_OwnRent_Base, by = "ID")

df <- df %>% mutate(OwnRent.Base = replace_na(OwnRent.Base, "none"))

df <- ungroup(df)

df <- select(df, -OwnRent)

rm(Modal_OwnRent_Base)
```

## Self-employed

```{r}

df <- df %>% mutate(SelfEmployed_TV = case_when(
  SelEmp2001.Head == 1 ~ "SomeoneElse",
  SelEmp2001.Head == 2 ~ "Both",
  SelEmp2001.Head == 3 ~ "Self",
  SelEmp2001.Head %in% c(0, 9, NA) ~ "Unknown"
))


Years_Self_Empl <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(SelfEmployed_TV) %>%
  filter(SelfEmployed_TV == "Self") %>%
  rename(Yrs_Self_Emp_Base = n) %>%
  select(-SelfEmployed_TV)

df <- left_join(df, Years_Self_Empl, by = "ID")


df <- df %>% mutate(Yrs_Self_Emp_Base = replace_na(Yrs_Self_Emp_Base, 0))

df <- select(df, -SelEmp2001.Head, -SelfEmp2017.Head)
rm(Years_Self_Empl)
```

##TotalLaborIncome.Head not recoded - continuous
```{r}
## TotalLaborIncome.Head not recoded - continuous

## Base - average

df$TotalLaborIncome.2003 <- ifelse(df$Year <= 2003, df$TotalLaborIncome.Head, NA)

df.labor <- df %>%
  group_by(ID) %>%
  dplyr::summarize(TotalLaborIncome.Base = mean(TotalLaborIncome.2003, na.rm = TRUE))
# merge back
df <- left_join(df, df.labor, by = "ID")

df$TotalLaborIncome_TV <- df$TotalLaborIncome.Head

df <- select(df, -c(TotalLaborIncome.Head, TotalLaborIncome.2003))
rm(df.labor)
```

## Salary or hourly

```{r, eval=TRUE}

df <- df %>% mutate(Hrly.Slry_TV = case_when(
  Hrly.Slry == 1 ~ "Salary",
  Hrly.Slry == 3 ~ "Hourly",
  Hrly.Slry == 7 ~ "Other",
  Hrly.Slry %in% c(0, 9, NA) ~ "Unknown",
  Hrly.Slry == 0 ~ "Inap"
))


Hrly.Slry.Base <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(Hrly.Slry_TV) %>%
  dplyr::slice(which.max(n)) %>%
  mutate(Hrly.Slry.Base = Hrly.Slry_TV) %>%
  select(ID, Hrly.Slry.Base)

df <- left_join(df, Hrly.Slry.Base, by = "ID")

df <- df %>% mutate(Hrly.Slry.Base = replace_na(Hrly.Slry.Base, "Inap"))

rm(Hrly.Slry.Base)
```

## Spouse labor income 

```{r}


# table(df$SpouseIncome1, df$Year) # thru 1993
# table(df$SpouseIncome2, df$Year) #1994 and up

df$SpouseIncome <- ifelse(df$Year < 1994, df$SpouseIncome1, ifelse(df$Year %in% c(1994:2017), df$SpouseIncome2, NA))
## Base - average
df$SpouseIncome.2003 <- ifelse(df$Year <= 2003, df$SpouseIncome, NA)

df.spouseincome <- df %>%
  group_by(ID) %>%
  dplyr::summarize(SpouseIncome.Base = mean(SpouseIncome.2003, na.rm = TRUE))
# merge back
df <- left_join(df, df.spouseincome, by = "ID")


df <- df %>% mutate(
  SpouseIncome_TV = replace_na(SpouseIncome, 0),
  SpouseIncome.Base = replace_na(SpouseIncome.Base, 0)
)

df <- select(df, -SpouseIncome1, -SpouseIncome2, -SpouseIncome.2003)
rm(df.spouseincome)
```

## Years covered by union Base
```{r}


df <- df %>% mutate(UnionCovered_TV = case_when(
  UnionCovered.Head == 1 ~ "Yes",
  UnionCovered.Head == 5 ~ "No",
  UnionCovered.Head %in% c(0, 8, 9, NA) ~ "Unknown"
))


Years_Union_Covered <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(UnionCovered_TV) %>%
  filter(UnionCovered_TV == "Yes") %>%
  rename(Yrs_Union_Cov = n) %>%
  select(-UnionCovered_TV)

df <- left_join(df, Years_Union_Covered, by = "ID")

df <- df %>% mutate(Yrs_Union_Cov_Base = replace_na(Yrs_Union_Cov, 0))
df <- select(df, -UnionCovered.Head, -Yrs_Union_Cov)
rm(Years_Union_Covered)
```

## Years worked Base

```{r}

df$YearsWorked_TV <- ifelse(df$YearsWorked.Head %in% c(0:98), df$YearsWorked.Head, NA)
# Base


YearsWorkd_Base <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(YearsWorked.Base = mean(YearsWorked.Head, na.rm = TRUE))

df <- left_join(df, YearsWorkd_Base, by = "ID")
df <- select(df, -YearsWorked.Head)
rm(YearsWorkd_Base)
```

## Work hours Base

```{r}

df$WorkHrs_TV <- df$WorkHrs.Head

## Base

WorkHours_Base <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(WorkHrs.Base = mean(WorkHrs.Head, na.rm = TRUE))

df <- left_join(df, WorkHours_Base, by = "ID")

df <- select(df, -WorkHrs.Head)
rm(WorkHours_Base)
```


## Extra job income?

```{r}


Extra.Job.Income2 <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(ExtraJobIncome.Base = mean(Extra.Job.Income2, na.rm = TRUE))

df <- left_join(df, Extra.Job.Income2, by = "ID")
df <- df %>% mutate(ExtraJobIncome.Base = replace_na(ExtraJobIncome.Base, 0)) %>% 
              select(-Extra.Job.Income2)


rm(Extra.Job.Income2)
```


## Overtime Hours

```{r}
Annual.OT.Hrs.All.Jobs <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(Annual.OT.Hrs.Base = mean(Annual.OT.Hrs.All.Jobs, na.rm = TRUE))


df <- left_join(df, Annual.OT.Hrs.All.Jobs, by = "ID")
df <- df %>% mutate(Annual.OT.Hrs.Base = replace_na(Annual.OT.Hrs.Base, 0))
rm(Annual.OT.Hrs.All.Jobs)

df <- df %>% rename(Annual.OT.Hrs_TV = Annual.OT.Hrs.All.Jobs)
```

## Overtime Income

```{r}
OT.Income <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(OT.Income.Base = mean(OT.Income, na.rm = TRUE))

df <- left_join(df, OT.Income, by = "ID")
df <- df %>% mutate(OT.Income.Base = replace_na(OT.Income.Base, 0))

df <- df %>% rename(OT.Income_TV = OT.Income)

rm(OT.Income)
```


## OT not reported earlier

```{r, eval=TRUE}

# df <- df %>% mutate(Any.OT.Not.Rep = case_when(
#  Any.OT.Not.Rep == 1 ~ "Yes",
# Any.OT.Not.Rep == 5 ~ "No",
# Any.OT.Not.Rep %in% c(0,8,9,NA) ~ "Unknown"
# ))


# Any.OT.Not.Rep <- df %>% group_by(ID) %>%
#  filter(Year < 2003) %>%
#  count(Any.OT.Not.Rep) %>%
#  filter(Any.OT.Not.Rep=="Yes") %>%
#  rename(Yrs.OT.Not.Rep = n) %>%
#  select(-Any.OT.Not.Rep)

# df <- left_join(df, Any.OT.Not.Rep, by="ID")

# df <- df %>% mutate(Any.OT.Not.Rep = replace_na(Any.OT.Not.Rep, 0),
# Yrs.OT.Not.Rep = replace_na(Yrs.OT.Not.Rep, 0))
# rm(Any.OT.Not.Rep)

df <- df %>% select(-Any.OT.Not.Rep)
```

## Extra Jobs

```{r, eval=TRUE}

df <- df %>% mutate(Extra.Job_TV = case_when(
  Extra.Job == 1 ~ "Yes",
  Extra.Job == 5 ~ "No",
  Extra.Job %in% c(0, 8, 9, NA) ~ "Unknown"
))


Extra.Job <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  count(Extra.Job_TV) %>%
  filter(Extra.Job_TV == "Yes") %>%
  rename(Yrs.Extra.Job_Base = n) %>%
  select(-Extra.Job_TV)


df <- left_join(df, Extra.Job, by = "ID")

df <- df %>% mutate(
  Yrs.Extra.Job_Base = replace_na(Yrs.Extra.Job_Base, 0)
)

df <- df %>% select(-Extra.Job)
rm(Extra.Job)
```



## Weekly hours at extra jobs Base

```{r, eval=TRUE}

Hrs.Extra.Jobs <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(Hrs.Extra.Jobs.Base = mean(Hrs.Extra.Jobs, na.rm = TRUE))

df <- left_join(df, Hrs.Extra.Jobs, by = "ID")

df <- df %>% mutate(Hrs.Extra.Jobs.Base = replace_na(Hrs.Extra.Jobs.Base, 0))

df <- df %>% rename(Hrs.Extra.Jobs_TV = Hrs.Extra.Jobs)

rm(Hrs.Extra.Jobs)
```


## Weekly hours when employed (asked of unemployed)

```{r, eval=FALSE}

Hrs.When.Empl <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(Hrs.When.Empl.Base = mean(Hrs.When.Empl, na.rm = TRUE))

df <- left_join(df, Hrs.When.Empl, by = "ID")

df <- df %>% mutate(Hrs.When.Empl.Base = replace_na(Hrs.When.Empl.Base, 0))

rm(Hrs.When.Empl)
```

## Number of extra jobs when unemployed

```{r, eval=FALSE}

Num.Extra.Jobs.Unempl <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(NumXtraJobsUnemp.Base = mean(Num.Extra.Jobs.Unempl, na.rm = TRUE))

df <- left_join(df, Num.Extra.Jobs.Unempl, by = "ID")
df <- df %>% mutate(NumXtraJobsUnemp.Base = replace_na(NumXtraJobsUnemp.Base, 0))

rm(Num.Extra.Jobs.Unempl)
```

## Hours extra jobs unemployed

```{r, eval=FALSE}

Hrs.Extra.Jobs.Unempl <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  summarise(HrsXtraJobsUnemp.Base = mean(Hrs.Extra.Jobs.Unempl, na.rm = TRUE))

df <- left_join(df, Hrs.Extra.Jobs.Unempl, by = "ID")
df <- df %>% mutate(HrsXtraJobsUnemp.Base = replace_na(HrsXtraJobsUnemp.Base, 0))


rm(Hrs.Extra.Jobs.Unempl)
```


# Create MMI and SMI

```{r}


df$SMI_TV <- ifelse(df$K6.Head >= 13 & df$K6.Head != 99, 1, ifelse(!is.na(df$K6.Head), 0, NA))
df$MMI_TV <- ifelse(df$K6.Head >= 5 & df$K6.Head < 13 & df$K6.Head != 99, 1, ifelse(!is.na(df$K6.Head), 0, NA))

df <- df %>% rename(K6_TV = K6.Head)


```


# Filter data to remove the 1% and restrict to 2003-2017

```{r, eval=TRUE}
library(readxl)
one_percent <- read_excel("/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/EPI Data Library - Annual wages by wage group.xlsx")

df <- left_join(df, one_percent, by="Year")

df <- filter(df, WorkHrs_TV >= 1820, RelationToHead == 10, TotalLaborIncome_TV < Top_1_Percent, TotalLaborIncome_TV>5000, Year >= 2003)

```


# Create exploitation variable for full time 40 and 35 hrs per week 

```{r, eval=TRUE}

df <- df %>%
  group_by(ID) %>%
  mutate(
    HourlyWage40 = ifelse(WorkHrs_TV >= 2080, TotalLaborIncome_TV / 2080, NA),
    TrueHourlyWage40 = ifelse(WorkHrs_TV >= 2080, TotalLaborIncome_TV / WorkHrs_TV, NA),
    Exploitation40 = (HourlyWage40 - TrueHourlyWage40) / HourlyWage40,
    HourlyWage35 = ifelse(WorkHrs_TV >= 1820, TotalLaborIncome_TV / 1820, NA),
    TrueHourlyWage35 = ifelse(WorkHrs_TV >= 1820, TotalLaborIncome_TV / WorkHrs_TV, NA),
    Exploitation35 = (HourlyWage35 - TrueHourlyWage35) / HourlyWage35) %>% 
  select(-HourlyWage40, -HourlyWage35, -TrueHourlyWage40, -TrueHourlyWage35)

```

# Save fully cleaned, drop a bunch

```{r, eval=TRUE}
df <- arrange(df, ID, Year)
df <- select(df, -c(Extra.Job.Income1, SampWeight1996, SampWeight2015, SampWeight9396Rev, SeqNum, UnionMember1981.Head, Hrs.Extra.Jobs_TV, InsuranceHeadFam, Medicaid, MedforPsych.Head, Insurance2, MedLearnDisord.Head, AlcUse.Head, EmployedNow1.Head, EverJob.Head, Hrs.When.Empl, Num.Extra.Jobs.Unempl, Hrs.Extra.Jobs.Unempl, Hrly.Slry, Drink5.Head, EmployedNow1.Head, EverJob.Head, Hrs.When.Empl, Num.Extra.Jobs.Unempl, Hrs.Extra.Jobs.Unempl, Hrly.Slry, Drink5.Head, Mean_Fam_Size_Base, TotalLaborIncome.Base, YearsWorked.Base, WorkHrs.Base, SelfEmployed_TV, HealthInsNow, Total.Jobs))
Full_CleanedData <- df
save(Full_CleanedData, file = "/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/Full_CleanedData.RData")
```



# Convert char to factor

```{r}

df<-Full_CleanedData

df <- as.data.frame(df)


df <- df %>% 
  mutate_if(is.character, as.factor)

```

# Collapse sparse factor levels

```{r}
df$GenHealth.Base <- ifelse(df$GenHealth.Base=="Unknown", NA, df$GenHealth.Base)
df$Hrs.Extra.Jobs.Base <- ifelse(df$Hrs.Extra.Jobs.Base==998, NA, df$Hrs.Extra.Jobs.Base)

df <- df %>% 
  mutate(EmploymentStatus_TV = as.character(EmploymentStatus_TV),
    EmploymentStatus_TV = case_when(
      EmploymentStatus_TV != "Working" ~ "Other",
      TRUE ~ EmploymentStatus_TV),
    EmploymentStatus.Base = as.character(EmploymentStatus.Base),
    EmploymentStatus.Base = case_when(
      EmploymentStatus.Base != "Working" ~ "Other",
      TRUE ~ EmploymentStatus.Base),
    Occupation_Base = as.character(Occupation_Base), 
    Occupation_Base = case_when(
      Occupation_Base %in% c("Extraction", "Construction") ~ "Construction/Extraction",
      Occupation_Base == "PrivateHousehold Workers" ~ "Personal Care",
    TRUE ~ Occupation_Base),
    ConditionPsych_TV = as.character(ConditionPsych_TV),
    ConditionPsych_TV = case_when(
    !ConditionPsych_TV %in% c("Unknown", "None") ~ "Any",
      TRUE ~ ConditionPsych_TV),
    DrEmotProb.Base = as.character(DrEmotProb.Base),
    DrEmotProb.Base = case_when(
      DrEmotProb.Base == "Unknown" ~ NA),
    DrLearnDisord.Base = as.character(DrLearnDisord.Base),
    DrLearnDisord.Base = case_when(
      DrLearnDisord.Base == "Unknown" ~ NA),
    GenHealth.Base = as.character(GenHealth.Base),
    GenHealth.Base = case_when(
      GenHealth.Base == "Unknown" ~ NA),
    EmploymentStatus.Base = as.character(EmploymentStatus.Base),
    EmploymentStatus.Base = case_when(
       	EmploymentStatus.Base %in% c("Other", "Retired") ~ "Other",
      TRUE ~ EmploymentStatus.Base)
)

df$DrinksPerDay_TV <- as.character(df$DrinksPerDay_TV)
df$DrinksPerDay_TV <- ifelse(df$DrinksPerDay_TV=="Unknown", NA, df$DrinksPerDay_TV)

```

# Create lagged and lagged cumulative version of time-varying variables

```{r, eval=TRUE}

df <- as.data.frame(df)

time.vars.num <- df %>%
  select(-contains("Base"), -SMI_TV, -MMI_TV) %>% 
  select_if(is.numeric)

vars1 <- names(time.vars.num)


df <- df %>%
  group_by(ID) %>%
  mutate_at(vars(vars1), list(cume = ~ cumsum(.))) %>%
  mutate_at(vars(-contains("Base"), -SampErrClust, -SampErrStrat, -Individ.Weight, -Sex, -ID, -Year, -Race_cat), 
            list(L = ~ lag(.)))

```




# Create Base average exploitation vars

```{r, eval=FALSE}

Base_Exploit <- df %>%
  group_by(ID) %>%
  filter(Year <= 2003) %>%
  transmute(
    Exploit35_Base = mean(Exploitation35, na.rm = TRUE),
    Exploit40_Base = mean(Exploitation40, na.rm = TRUE)
  )

df <- left_join(df, Base_Exploit, by = "ID") %>% 
        distinct()

df <- ungroup(df)


```





# Drop unneeded variables and save

```{r, eval=TRUE}

Full_CleanedData <- df

save(Full_CleanedData, file = "/Users/sjp2154/Dropbox/Gender economics/Exploitation IPW-MSM/PSID-Exploitation/Full_CleanedData.RData")
names(df)

```




